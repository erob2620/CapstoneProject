{"version":3,"sources":["app.min.js"],"names":["config","$routeProvider","$locationProvider","when","templateUrl","controller","controllerAs","otherwise","redirectTo","html5Mode","run","$rootScope","$location","authentication","$on","event","nextRoute","currentRoute","path","isLoggedIn","angular","module","designCtrl","$scope","DrawingService","meanData","$routeParams","vm","this","designId","currentEmail","currentUser","email","shareInfo","id","permission","shapeType","drawingMode","isDown","startPosition","viewOnly","canvas","init","connectToSocket","console","log","fabric","Canvas","selection","setUpCanvas","getDesign","success","data","setCanvasSize","design","size","canvasDesign","loadFromJSON","renderAll","bind","o","object","set","designName","title","error","e","location","pathname","toString","pathArray","split","socket","io","query","on","msg","document","addEventListener","keyCode","getActiveObject","shapeToRemove","remove","saveCanvas","keepSquare","canvasJson","toJSON","canvasString","JSON","stringify","owner","saveDesign","emit","setWidth","width","setHeight","height","changeToRect","changeToEllipse","changeToTriangle","changeToText","changeToImgShape","getElementById","supports","href","toDataURL","format","quality","download","alert","x","offsetX","y","offsetY","createShape","shape","add","deltaX","deltaY","setCoords","rx","Math","abs","ry","strokeWidth","originX","originY","getCenterPoint","radius","points","starPolygonPoints","get","length","boundingBox","getBoundingBox","_objects","forEach","item","getBoundingRect","oCoords","setObjectsCoords","top","getHeight","rotate","setTransformMatrix","setActiveObject","type","observe","target","resizeToScale","openModal","$","css","closeModal","shareDesign","Object","prototype","scaleX","scaleY","i","p","$inject","homeCtrl","profileCtrl","user","designs","sharedDesigns","getProfile","getDesigns","getSharedDesigns","openDiv","value","style","display","required","timeSince","date","oldDate","Date","monthNames","getMonth","getDate","getFullYear","submitNewDesign","createDesign","loginCtrl","credentials","password","onSubmit","login","err","message","then","registerCtrl","name","register","ShapeService","drawingFactory","options","callback","parentClass","createRect","createEllipse","createTriangle","createImgShape","createText","factory","shapeFactory","rect","Rect","left","stroke","fill","ellipse","Ellipse","triangle","Triangle","text","IText","fontSize","params","group","loadSVGFromURL","objects","loadedObjects","Group","transformMatrix","getAttribute","push","$http","$window","saveToken","token","localStorage","getToken","logout","removeItem","payload","atob","parse","exp","now","post","service","headers","Authorization","navigationCtrl","logOut","navigation","restrict","directive"],"mappings":"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","file":"app.min.js","sourcesContent":["(function() {\r\n    angular.module('app', ['ngRoute']);\r\n    \r\n    function config($routeProvider, $locationProvider) {\r\n        $routeProvider\r\n            .when('/', {\r\n                  templateUrl: 'home/home.view.html',\r\n                  controller: 'homeCtrl',\r\n                  controllerAs: 'vm'\r\n                  \r\n            })\r\n            .when('/register', {\r\n                templateUrl: '/auth/register/register.view.html',\r\n                controller: 'registerCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/login', {\r\n                templateUrl: '/auth/login/login.view.html',\r\n                controller:'loginCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/profile', {\r\n                templateUrl: '/profile/profile.view.html',\r\n                controller:'profileCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/design/:designId', {\r\n                templateUrl: '/design/design.view.html',\r\n                controller:'designCtrl',\r\n                controllerAs:'vm'\r\n            \r\n            })\r\n            .otherwise({redirectTo: '/'});\r\n        $locationProvider.html5Mode(true);\r\n    }\r\n    \r\n    function run($rootScope, $location, authentication) {\r\n        $rootScope.$on('$routeChangeStart', function(event, nextRoute, currentRoute) {\r\n            if( $location.path() === '/profile' && !authentication.isLoggedIn()) {\r\n                $location.path('/');\r\n            }\r\n        });\r\n    }\r\n    angular\r\n        .module('app')\r\n        .config(['$routeProvider', '$locationProvider', config])\r\n        .run(['$rootScope', '$location', 'authentication', run]);\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('designCtrl', designCtrl); \r\n    \r\n    designCtrl.$inject = ['$location','$scope', 'DrawingService', 'meanData', 'authentication', '$routeParams'];\r\n    \r\n    function designCtrl($location, $scope, DrawingService, meanData, authentication, $routeParams) {\r\n        var vm = this;\r\n        vm.designId = $routeParams.designId;\r\n        vm.currentEmail = authentication.currentUser().email;\r\n        vm.shareInfo = {\r\n            id: $routeParams.designId,\r\n            email: '',\r\n            permission: ''\r\n        };\r\n        \r\n        vm.shapeType = 'rect';\r\n        vm.drawingMode = true;\r\n        vm.isDown = false;\r\n        vm.startPosition = {};\r\n        vm.viewOnly = false;\r\n        vm.canvas;\r\n        vm.init = function() {\r\n            vm.connectToSocket();\r\n            console.log('initializing fabric');\r\n            vm.canvas = new fabric.Canvas('c');\r\n            vm.canvas.selection = false;\r\n            vm.setUpCanvas();\r\n            meanData.getDesign(vm.designId)\r\n                .success(function(data) {\r\n                    vm.setCanvasSize(data.design.size);\r\n                    vm.canvasDesign = data.design.design;\r\n                    if(data.permission === 'edit') {\r\n                        vm.canvas.loadFromJSON(vm.canvasDesign, vm.canvas.renderAll.bind(vm.canvas));\r\n                    } else {\r\n                        vm.canvas.loadFromJSON(vm.canvasDesign, vm.canvas.renderAll.bind(vm.canvas), function(o, object) {\r\n                            object.set('selectable', false);\r\n                        });\r\n                        vm.viewOnly = true;\r\n                    }\r\n                    vm.designName = data.design.title;\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });  \r\n        };\r\n        vm.connectToSocket = function(){\r\n            console.log(location.pathname.toString());\r\n            var pathArray = location.pathname.split('/');\r\n            socket = io('/' + pathArray[1], {query: 'room=' + pathArray[2]});\r\n            \r\n            socket.on('updateGroup', function(msg) {\r\n                console.log(msg); \r\n            });\r\n            socket.on('designUpdate', function(design) {\r\n                console.log(design);\r\n                if(!vm.viewOnly) {\r\n                    vm.canvas.loadFromJSON(design.design, vm.canvas.renderAll.bind(vm.canvas));\r\n                    \r\n                } else {\r\n                    vm.canvas.loadFromJSON(design.design, vm.canvas.renderAll.bind(vm.canvas), function(o, object) {\r\n                            object.set('selectable', false);\r\n                    });\r\n                }\r\n            }); \r\n        }\r\n        document.addEventListener('keydown', function(event) {\r\n            console.log('in key down');\r\n            switch (event.keyCode) {\r\n                case 46:\r\n                    if(vm.canvas.getActiveObject()) {\r\n                        console.log('trying to delete');\r\n                        var shapeToRemove = vm.canvas.getActiveObject();\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.renderAll();\r\n                        vm.saveCanvas();\r\n                        return;\r\n                    }\r\n                    break;\r\n                case 16:\r\n                    vm.keepSquare = true;\r\n                    break;\r\n            }\r\n        });\r\n        document.addEventListener('keyup', function(event) {\r\n            switch( event.keyCode) {\r\n                case 16: \r\n                    console.log('shift released');\r\n                    vm.keepSquare = false;\r\n                    break;\r\n            }\r\n        });\r\n        vm.saveCanvas = function() {\r\n            var canvasJson = vm.canvas.toJSON();\r\n            console.log(canvasJson);\r\n            var canvasString = JSON.stringify(canvasJson);\r\n            vm.currentEmail = authentication.currentUser().email;\r\n            console.log(vm.currentEmail);\r\n            vm.design = {\r\n                id: vm.designId,\r\n                owner: vm.currentEmail,\r\n                design: canvasString\r\n            }\r\n            meanData.saveDesign(vm.design)\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                    console.log('about to call socket');\r\n                    socket.emit('updateDesign', vm.design);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        }\r\n        vm.setCanvasSize = function(size) {\r\n            console.log(size);\r\n            vm.canvas.setWidth(size.width);\r\n            vm.canvas.setHeight(size.height);\r\n\r\n        };\r\n        vm.changeToRect = function() {\r\n            vm.shapeType = 'rect';\r\n        };\r\n        vm.changeToEllipse = function() {\r\n            vm.shapeType = 'ellipse';\r\n        };\r\n        vm.changeToTriangle = function() {\r\n            vm.shapeType = 'triangle';\r\n        };\r\n        vm.changeToText = function() {\r\n            vm.shapeType = 'i-text';\r\n        };\r\n        vm.changeToImgShape = function() {\r\n            vm.shapeType = 'imgShape';\r\n        };\r\n        vm.setUpCanvas = function() {\r\n            document.getElementById('exportLink').addEventListener('click', function(e) {\r\n                console.log('called');\r\n                if(!fabric.Canvas.supports('toDataURL')) {\r\n                    alert('This browlser doesn\\'t support exporting')\r\n                } else {\r\n                    console.log('trying to export');\r\n                    this.href = vm.canvas.toDataURL({\r\n                        format: 'png',\r\n                        quality: 0.8\r\n                    });\r\n                    this.download = vm.designName + '.png';\r\n                }\r\n            });\r\n            vm.canvas.on('mouse:down', function(event) {\r\n                if(!vm.drawingMode || vm.viewOnly) return;\r\n                vm.isDown = true;\r\n                vm.startPosition.x = event.e.offsetX - 5;\r\n                vm.startPosition.y = event.e.offsetY - 5;\r\n                vm.drawingMode = false;\r\n                DrawingService.createShape({\r\n                    shapeType: vm.shapeType,\r\n                    startPosition: vm.startPosition\r\n                }, function(shape) {\r\n                    vm.shape = shape;\r\n                    vm.canvas.add(vm.shape);\r\n                    vm.canvas.renderAll();\r\n                    vm.drawingMode = true;\r\n                });\r\n\r\n            });\r\n            vm.canvas.on('mouse:move', function(event) {\r\n                var deltaX, deltaY;\r\n                if(!vm.isDown || !vm.drawingMode || vm.viewOnly) return;\r\n                switch(vm.shapeType) {\r\n                    case 'rect':\r\n                        if(vm.keepSquare) {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = deltaX;\r\n                        } else {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        }\r\n\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'ellipse':\r\n                        var rx = Math.abs(vm.startPosition.x - event.e.offsetX) / 2;\r\n                        var ry = Math.abs(vm.startPosition.y - event.e.offsetY) / 2;\r\n                        if( rx > vm.shape.strokeWidth) {\r\n                            rx -= vm.shape.strokeWidth / 2;\r\n                        }                \r\n                        if( ry > vm.shape.strokeWidth) {\r\n                            ry -= vm.shape.strokeWidth / 2;\r\n                        }\r\n                        vm.shape.set({rx: rx, ry: ry});\r\n\r\n                        if(vm.startPosition.x > event.e.offsetX) {\r\n                            vm.shape.set({originX: 'right'});\r\n                        } else {\r\n                            vm.shape.set({originX: 'left'});\r\n                        }\r\n                        if(vm.startPosition.y > event.e.offsetY) {\r\n                            vm.shape.set({originY: 'bottom'});\r\n                        } else {\r\n                            vm.shape.set({originY: 'top'});\r\n                        }\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'triangle':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'polygon':\r\n                        var centerX = vm.shape.getCenterPoint().x;\r\n                        console.log(vm.shape.getCenterPoint());\r\n                        var radius = (event.e.offsetX - vm.startPosition.x) / 2;\r\n                        var points = starPolygonPoints(vm.shape.get('points').length / 2, radius, radius / 2);\r\n                        var boundingBox = vm.shape.getBoundingBox();\r\n                        vm.shape.set({points: points, width: boundingBox.width, height: boundingBox.height});\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'i-text':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'imgShape':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape._objects.forEach(function(item) {\r\n                            item.setWidth(deltaX);\r\n                            item.setHeight(deltaY);\r\n                            item.setCoords();\r\n                        });\r\n                        var boundingRect = vm.shape.getBoundingRect();\r\n                        console.log(vm.shape.oCoords);\r\n                        vm.shape.set('left', vm.startPosition.x);\r\n                        vm.shape.set('top', vm.startPosition.y);\r\n                        vm.shape.setObjectsCoords();\r\n                        break;\r\n                }\r\n                vm.canvas.renderAll();\r\n            });\r\n            vm.canvas.on('mouse:up', function(event) {\r\n                vm.isDown = false;\r\n\r\n                if(vm.drawingMode) {\r\n                    if(vm.shapeType === 'rect') {\r\n                        if(event.e.offsetY - vm.startPosition.y < 0) {\r\n                            console.log('change spinner');\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    } else if(vm.shapeType === 'triangle') {\r\n                        if(vm.offsetY - vm.startPosition.y < 0) {\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.rotate(180);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    } else if(vm.shapeType === 'imgShape') {\r\n                        vm.shape.setWidth(vm.shape._objects[0].width);\r\n                        vm.shape.setHeight(vm.shape._objects[0].height);\r\n                        vm.shape.setTransformMatrix([1,0,0,1,-30,-20]);\r\n                        vm.shape.setCoords();\r\n                        console.log(vm.shape);\r\n                        vm.canvas.renderAll();\r\n                    }\r\n                    vm.canvas.setActiveObject(vm.shape);\r\n                    vm.saveCanvas();\r\n                } \r\n            });\r\n            vm.canvas.on('object:selected', function() {\r\n                if(!vm.viewOnly) {\r\n                    vm.drawingMode = false;\r\n                    var shape = vm.canvas.getActiveObject();\r\n                    vm.shapeType = shape.type;\r\n                    console.log(vm.shapeType);\r\n                }\r\n            });\r\n            vm.canvas.on('selection:cleared', function() {\r\n                vm.drawingMode = true;\r\n            });\r\n    \r\n            vm.canvas.observe('object:modified', function(e) {\r\n                e.target.resizeToScale();\r\n                vm.saveCanvas();\r\n            });\r\n            vm.openModal = function() {\r\n                console.log('modal opened');\r\n                $('.shareModal').css('display','block');\r\n            };\r\n            vm.closeModal = function() {\r\n                $('.shareModal').css('display', 'none');\r\n            };\r\n            vm.shareDesign = function() {\r\n                if(!vm.viewOnly) {\r\n                meanData.shareDesign(vm.shareInfo)\r\n                    .success(function(data){\r\n                        console.log(data);\r\n                        vm.closeModal();\r\n                        alert('Project shared');\r\n                    })\r\n                    .error(function(e) {\r\n                        console.log(e);\r\n                    });\r\n                }\r\n            };\r\n\r\n            fabric.Object.prototype.resizeToScale = function() {\r\n                console.log(this);\r\n                switch(this.type) {\r\n                    case 'rect':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1; \r\n                        break;\r\n                    case 'ellipse':\r\n                        this.rx *= this.scaleX;\r\n                        this.ry *= this.scaleY;\r\n                        this.width = this.rx * 2;\r\n                        this.height = this.ry * 2;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'triangle':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'polyline':\r\n                    case 'polygon':\r\n                        var points = this.get('points');\r\n                        for (var i = 0; i < points.length; i++) {\r\n                            var p = points[i];\r\n                            p.x *= this.scaleX;\r\n                            p.y *= this.scaleY;\r\n                        }\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        this.width = this.getBoundingBox().width;\r\n                        this.height = this.getBoundingBox().height;\r\n                        break;\r\n                    case 'imgShape':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        vm.init();\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('homeCtrl', homeCtrl);\r\n    \r\n    function homeCtrl() {\r\n        console.log('home controller is running');\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('profileCtrl', profileCtrl);\r\n    profileCtrl.$inject = ['$location', 'meanData', 'authentication', '$scope'];\r\n    function profileCtrl($location, meanData, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        vm.user = {};\r\n        vm.designs = {};\r\n        vm.sharedDesigns = {};\r\n        vm.currentEmail = authentication.currentUser().email;\r\n        vm.design = {\r\n            title: '',\r\n            owner: vm.currentEmail,\r\n            design: '',\r\n            size: ''\r\n        };\r\n        meanData.getProfile()\r\n            .success(function(data) {\r\n                vm.user = data;\r\n                console.log(vm.user.email);\r\n                meanData.getDesigns(vm.user.email)\r\n                    .success(function(data) {\r\n                        console.log(data);\r\n                        vm.designs = data.designs;\r\n                        meanData.getSharedDesigns(vm.user.email)\r\n                            .success(function(data) {\r\n                            vm.sharedDesigns = data.sharedDesigns;\r\n                        })\r\n                        .error( function(e) {\r\n                            console.log(e);\r\n                        });\r\n                    })\r\n                    .error( function(e) {\r\n                        console.log(e);\r\n                    });\r\n            })\r\n            .error( function(e) {\r\n                console.log(e);\r\n            });\r\n        vm.openModal = function() {\r\n            console.log('modal opened');\r\n            $('.designModal').css('display','block');\r\n        };\r\n        $scope.openDiv = function(value) {\r\n            console.log(value);\r\n            if(value === 'custom') {\r\n                console.log('yay custom');\r\n                document.getElementById('customSizeDiv').style.display = 'block';\r\n                document.getElementById('width').required = true;\r\n                document.getElementById('height').required = true;\r\n                \r\n            } else {\r\n                console.log('no custom');\r\n                document.getElementById('customSizeDiv').style.display = 'none';\r\n                document.getElementById('height').required = false;\r\n                document.getElementById('width').required = false;\r\n\r\n            }\r\n        };\r\n        vm.closeModal = function() {\r\n            $('.designModal').css('display', 'none');\r\n        };\r\n        vm.timeSince = function(date) {\r\n            var oldDate = new Date(date);\r\n            var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\n             return monthNames[oldDate.getMonth()] + ' ' + oldDate.getDate() + ', ' + oldDate.getFullYear();\r\n        };\r\n        vm.submitNewDesign = function() {\r\n            if(vm.design.size === 'Large') {\r\n                vm.design.size = {width: 1500, height:1000};\r\n            } else if(vm.design.size === 'Medium') {\r\n                vm.design.size = {width: 800, height: 800};\r\n            } else if(vm.design.size === 'Small') {\r\n                vm.design.size = {width: 400, height: 600};\r\n            } else if(vm.design.size === 'Custom') {\r\n                vm.design.size = {width: document.getElementById('width').value, height: document.getElementById('height').value};\r\n            }\r\n            meanData.createDesign(vm.design)\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                })\r\n                .success(function(data){\r\n                    console.log('in controller');\r\n                    console.log(data);\r\n                    $location.path('/design/' + data.id);\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('loginCtrl', loginCtrl);\r\n    \r\n    loginCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function loginCtrl($location, authentication,$scope) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            email: '',\r\n            password: ''\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            authentication\r\n                .login(vm.credentials)\r\n                .error(function(err) {\r\n                    console.log(err);\r\n                    $scope.error = err.message;\r\n//                    $scope.$apply();\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    \r\n    angular\r\n        .module('app')\r\n        .controller('registerCtrl', registerCtrl);\r\n    registerCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function registerCtrl($location, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            name: \"\",\r\n            email: \"\",\r\n            password: \"\"\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            console.log('submitting registration');\r\n            authentication\r\n                .register(vm.credentials)\r\n                .error(function(err) {\r\n                    $scope.error = err.message;\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular.module('app')\r\n        .factory('DrawingService', DrawingService);\r\n    \r\n    DrawingService.$inject = ['ShapeService'];\r\n    function DrawingService(ShapeService) {\r\n        \r\n        var drawingFactory = {};\r\n        \r\n        drawingFactory.createShape = function(options, callback) {\r\n            var parentClass = null;\r\n            console.log(options.shapeType);\r\n            if(options.shapeType === 'rect') {\r\n                parentClass = ShapeService.createRect;\r\n            } else if(options.shapeType === 'ellipse') {\r\n                parentClass = ShapeService.createEllipse;\r\n            } else if(options.shapeType === 'triangle') {\r\n                parentClass = ShapeService.createTriangle;\r\n            } else if(options.shapeType === 'imgShape') {\r\n                parentClass = ShapeService.createImgShape;\r\n            } else if(options.shapeType === 'i-text') {\r\n                parentClass = ShapeService.createText;\r\n            }\r\n            \r\n            new parentClass(options, function(shape) {\r\n                callback(shape);\r\n            });\r\n        }\r\n        return drawingFactory;\r\n    };\r\n})();\n(function() {\r\n    angular.module('app')\r\n            .factory('ShapeService', ShapeService);\r\n    \r\n    function ShapeService() {\r\n        \r\n        var shapeFactory = {};\r\n        \r\n        shapeFactory.createRect = function(options, callback) {\r\n            var rect = new fabric.Rect({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                stroke:'black',\r\n                strokeWidth:1,\r\n                fill:'transparent'\r\n            });\r\n            callback(rect);\r\n        }\r\n        shapeFactory.createEllipse = function(options, callback) {\r\n            var ellipse = new fabric.Ellipse({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                originX: 'left',\r\n                originY: 'top',\r\n                rx: 0,\r\n                ry: 0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1                \r\n            });\r\n            callback(ellipse);\r\n        }\r\n        shapeFactory.createTriangle = function(options, callback) {\r\n            var triangle = new fabric.Triangle({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1            \r\n            });\r\n            callback(triangle);\r\n        }\r\n        shapeFactory.createText = function(options, callback) {\r\n            var text = new fabric.IText(\"Click to change text\", {\r\n                top: options.startPosition.x,\r\n                left: options.startPosition.y,\r\n                fontSize: 18,\r\n            });\r\n            callback(text);\r\n        }\r\n        shapeFactory.createImgShape = function(params, callback) {\r\n            var group = [];\r\n            fabric.loadSVGFromURL('svgs/imageShape.svg', function(objects, options) {\r\n                var loadedObjects = new fabric.Group(group);\r\n                loadedObjects.set({\r\n                    left: params.startPosition.x,\r\n                    top: params.startPosition.y,\r\n                    fill: 'transparent',\r\n                    stroke: 'black',\r\n                    originX: 'left',\r\n                    originY: 'top',\r\n                    strokeWidth: 1,\r\n                    type: 'imgShape',\r\n                    transformMatrix: [1,0,0,1,0,0]\r\n                });\r\n                console.log(loadedObjects);\r\n                callback(loadedObjects);\r\n            },\r\n            function(item, object) {\r\n                object.set('id', item.getAttribute('id'));\r\n                group.push(object);\r\n            });\r\n\r\n        }\r\n        \r\n        return shapeFactory;\r\n    };\r\n    \r\n    \r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .service('authentication', authentication);\r\n    \r\n    authentication.$inject = ['$http', '$window'];\r\n    function authentication($http, $window) {\r\n        var saveToken = function(token) {\r\n            $window.localStorage['mean-token'] = token;\r\n        };\r\n        \r\n        var getToken = function() {\r\n            return $window.localStorage['mean-token'];\r\n        };\r\n        \r\n        logout = function() {\r\n            $window.localStorage.removeItem('mean-token');\r\n        };\r\n        \r\n        var isLoggedIn = function() {\r\n            var token = getToken();\r\n            var payload;\r\n            \r\n            if(token) {\r\n                payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                \r\n                return payload.exp > Date.now() / 1000;\r\n            } else {\r\n                return false;\r\n            }\r\n        };\r\n        var currentUser = function() {\r\n            if(isLoggedIn()) {\r\n                var token = getToken();\r\n                var payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                return {\r\n                    email: payload.email,\r\n                    name: payload.name\r\n                };\r\n            }\r\n        };\r\n        register = function(user) {\r\n            return $http.post('/api/register', user).success(function(data) {\r\n                saveToken(data.token);\r\n            })\r\n            .error(function(e) {\r\n            \r\n            });\r\n        };\r\n        login = function(user) {\r\n            return $http.post('/api/login', user).success(function(data) {\r\n                saveToken(data.token);\r\n            });\r\n        };\r\n        return {\r\n            saveToken: saveToken,\r\n            getToken: getToken,\r\n            logout: logout,\r\n            isLoggedIn: isLoggedIn,\r\n            currentUser: currentUser,\r\n            register: register,\r\n            login: login,\r\n            logout: logout\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .service('meanData', meanData);\r\n    \r\n    meanData.$inject = ['$http', 'authentication', '$location'];\r\n    function meanData($http, authentication, $location) {\r\n        var getProfile = function() {\r\n            console.log(authentication.getToken());\r\n            return $http.get('/api/profile', {\r\n                headers: {\r\n                    Authorization: 'Bearer ' + authentication.getToken()\r\n                }\r\n            });\r\n        };\r\n        var getDesigns = function(email) {\r\n            console.log(email);\r\n            return $http.get('/api/designs', {params: {email: email}})\r\n                .success(function(data) {\r\n                    console.log(data);   \r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        };\r\n        var getSharedDesigns = function(email) {\r\n            return $http.get('api/designs/shared', {params: {email: email}})\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        };\r\n        var getDesign = function(designId) {\r\n            return $http.get('/api/design', {params: {id: designId, email: authentication.currentUser().email}})\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e)\r\n                });\r\n        };\r\n        var saveDesign = function(design) {\r\n              return $http.post('/api/designs/save', design)\r\n                    .success(function(data) {\r\n                  console.log(data);\r\n              });\r\n        };\r\n        var createDesign = function(design) {\r\n            return $http.post('/api/designs/save', design)\r\n                .success(function(data) {\r\n                  console.log('in data service');\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n            \r\n        };\r\n        var shareDesign = function(shareInfo) {\r\n              return $http.post('api/designs/share', shareInfo)\r\n                .success(function(data) {\r\n                  console.log('in mean data');\r\n                })\r\n                .error(function(e) {\r\n                  console.log(e);\r\n                });\r\n        };\r\n        \r\n        return {\r\n            getProfile: getProfile,\r\n            getDesigns: getDesigns,\r\n            getSharedDesigns: getSharedDesigns,\r\n            saveDesign: saveDesign,\r\n            getDesign: getDesign,\r\n            createDesign: createDesign,\r\n            shareDesign: shareDesign\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('navigationCtrl', navigationCtrl);\r\n    navigationCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function navigationCtrl($location, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        $scope.isLoggedIn = function() {\r\n            return authentication.isLoggedIn();\r\n        }\r\n        $scope.currentUser = function() {\r\n            if($scope.isLoggedIn()) {\r\n                return authentication.currentUser().name;\r\n            }\r\n        }\r\n        console.log($scope.isLoggedIn());\r\n        $scope.logOut = function() {\r\n            authentication.logout();\r\n            $location.path('/');\r\n        }\r\n    }\r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .directive('navigation', navigation);\r\n    \r\n    function navigation() {\r\n        return {\r\n            restrict: 'A',\r\n            templateUrl: '/common/directives/navigation/navigation.template.html',\r\n            controller: 'navigationCtrl as navvm'\r\n        };\r\n    }\r\n})();"]}