{"version":3,"sources":["app.min.js"],"names":["config","$routeProvider","$locationProvider","when","templateUrl","controller","controllerAs","otherwise","redirectTo","html5Mode","run","$rootScope","$location","authentication","$on","event","nextRoute","currentRoute","path","isLoggedIn","angular","module","designCtrl","$scope","DrawingService","meanData","$routeParams","regularPolygonPoints","sideCount","radius","sweep","Math","PI","cx","cy","points","i","x","cos","y","sin","push","vm","this","lastTime","Date","getTime","designId","currentUser","currentEmail","email","currentName","name","shareInfo","id","permission","textOptions","text","fontFamily","fontSize","textAlign","copiedObject","copiedObjects","Array","state","mods","shapeType","drawingMode","isDown","startPosition","viewOnly","canvas","init","connectToSocket","fabric","Canvas","renderOnAddRemove","selection","setUpCanvas","observe","objectSelectedHandler","getDesign","success","data","setCanvasSize","design","size","canvasDesign","loadFromJSON","renderAll","bind","o","object","set","updateState","designName","title","error","e","console","log","date","now","doubleClickedHandler","document","getElementById","style","display","shape","getActiveObject","$","val","label","comment","css","saveShapeInfo","updateDesign","saveCanvas","pathArray","location","pathname","split","socket","io","query","on","msg","messages","postfix","getHours","hours","minutes","getMinutes","time","append","html","scrollTop","scrollHeight","addClass","util","enlivenObjects","JSON","parse","insertAt","index","add","toRemove","remove","message","copy","getActiveGroup","objects","clone","top","left","paste","length","undo","clear","redo","sendMessage","emit","addEventListener","keyCode","shapeToRemove","updateShapeDeletion","keepSquare","ctrlKey","preventDefault","target","type","changeToPointer","changeToText","changeToRect","changeToPolygon","changeToEllipse","changeToImgShape","changeToLine","changeToTriangle","canvasJson","toDatalessJSON","canvasString","stringify","owner","saveDesign","toUpdate","getObjects","indexOf","toDatalessObject","toDelete","shapeAdded","toAdd","setWidth","width","setHeight","height","removeClass","defaultCursor","discardActiveObject","toggleChat","supports","href","toDataURL","download","replaceAll","alert","offsetX","offsetY","createShape","deltaX","deltaY","setCoords","rx","abs","ry","strokeWidth","originX","originY","x2","y2","getHeight","rotate","setActiveObject","$apply","value","change","fontAlign","fontWeight","fontStyle","textDecoration","resizeToScale","openModal","closeModal","shareDesign","Object","prototype","scaleX","scaleY","$inject","homeCtrl","profileCtrl","user","designs","sharedDesigns","getProfile","getDesigns","getSharedDesigns","openDiv","required","timeSince","oldDate","monthNames","getMonth","getDate","getFullYear","submitNewDesign","createDesign","loginCtrl","credentials","password","onSubmit","login","err","then","ShapeService","drawingFactory","options","callback","parentClass","createRect","createEllipse","createTriangle","createImgShape","createText","createPolygon","createLine","factory","shapeFactory","rect","Rect","stroke","fill","shapeInfo","ellipse","Ellipse","triangle","Triangle","IText","params","oSVG","Image","fromURL","line","Line","polygon","Polygon","registerCtrl","register","$http","$window","saveToken","token","localStorage","getToken","logout","removeItem","payload","atob","exp","post","service","get","headers","Authorization","navigationCtrl","logOut","navigation","restrict","directive"],"mappings":"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","file":"app.min.js","sourcesContent":["(function() {\r\n    angular.module('app', ['ngRoute']);\r\n    \r\n    function config($routeProvider, $locationProvider) {\r\n        $routeProvider\r\n            .when('/', {\r\n                  templateUrl: 'home/home.view.html',\r\n                  controller: 'homeCtrl',\r\n                  controllerAs: 'vm'\r\n                  \r\n            })\r\n            .when('/register', {\r\n                templateUrl: '/auth/register/register.view.html',\r\n                controller: 'registerCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/login', {\r\n                templateUrl: '/auth/login/login.view.html',\r\n                controller:'loginCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/profile', {\r\n                templateUrl: '/profile/profile.view.html',\r\n                controller:'profileCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/design/:designId', {\r\n                templateUrl: '/design/design.view.html',\r\n                controller:'designCtrl',\r\n                controllerAs:'vm'\r\n            \r\n            })\r\n            .otherwise({redirectTo: '/'});\r\n        $locationProvider.html5Mode(true);\r\n    }\r\n    \r\n    function run($rootScope, $location, authentication) {\r\n        $rootScope.$on('$routeChangeStart', function(event, nextRoute, currentRoute) {\r\n            if( $location.path() === '/profile' && !authentication.isLoggedIn()) {\r\n                $location.path('/');\r\n            }\r\n        });\r\n    }\r\n    angular\r\n        .module('app')\r\n        .config(['$routeProvider', '$locationProvider', config])\r\n        .run(['$rootScope', '$location', 'authentication', run]);\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('designCtrl', designCtrl); \r\n    \r\n    designCtrl.$inject = ['$location','$scope', 'DrawingService', 'meanData', 'authentication', '$routeParams'];\r\n    \r\n    function designCtrl($location, $scope, DrawingService, meanData, authentication, $routeParams) {\r\n        var vm = this;\r\n        vm.lastTime = new Date().getTime();\r\n        vm.designId = $routeParams.designId;\r\n        vm.currentUser = authentication.currentUser();\r\n        vm.currentEmail = vm.currentUser.email;\r\n        vm.currentName = vm.currentUser.name;\r\n        vm.shareInfo = {\r\n            id: $routeParams.designId,\r\n            email: '',\r\n            permission: ''\r\n        };\r\n        vm.textOptions = {\r\n            text: '',\r\n            fontFamily: '',\r\n            fontSize: '',\r\n            textAlign: ''\r\n        };\r\n        vm.copiedObject;\r\n        vm.copiedObjects = new Array();\r\n        vm.state = new Array();\r\n        vm.mods = 0;\r\n        vm.shapeType = 'pointer';\r\n        vm.drawingMode = true;\r\n        vm.isDown = false;\r\n        vm.startPosition = {};\r\n        vm.viewOnly = false;\r\n        vm.canvas;\r\n        vm.init = function() {\r\n            vm.connectToSocket();\r\n            vm.canvas = new fabric.Canvas('c',{renderOnAddRemove: false});\r\n            vm.canvas.selection = false;\r\n            vm.setUpCanvas();\r\n            vm.canvas.observe('mouse:down', vm.objectSelectedHandler);\r\n            meanData.getDesign(vm.designId)\r\n                .success(function(data) {\r\n                    vm.setCanvasSize(data.design.size);\r\n                    vm.canvasDesign = data.design.design;\r\n                    if(data.permission === 'edit') {\r\n                        vm.canvas.loadFromJSON(vm.canvasDesign, vm.canvas.renderAll.bind(vm.canvas));\r\n                        \r\n                    } else {\r\n                        vm.canvas.loadFromJSON(vm.canvasDesign, vm.canvas.renderAll.bind(vm.canvas), function(o, object) {\r\n                            object.set('selectable', false);\r\n                        });\r\n                        vm.viewOnly = true;\r\n                    }\r\n                    vm.updateState();\r\n                    vm.designName = data.design.title;\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });  \r\n        };\r\n        vm.objectSelectedHandler = function(event) {\r\n            console.log('in selected handler')\r\n            var date = new Date();\r\n            var now  = date.getTime();\r\n            if(now - vm.lastTime < 400) {\r\n                console.log('double clicked');\r\n                vm.doubleClickedHandler(event);\r\n            } else {\r\n                console.log(document.getElementById('shapeInfoDiv'));\r\n                document.getElementById('shapeInfoDiv').style.display = 'none';\r\n\r\n            }\r\n            vm.lastTime = now;\r\n        };\r\n        vm.doubleClickedHandler = function(event) {\r\n            var shape = vm.canvas.getActiveObject();\r\n            console.log(shape);\r\n            $('#label').val(shape.label);\r\n            $('#comment').val(shape.comment);\r\n            $('.shapeInfoModal').css('display','inline-block');\r\n        };\r\n        vm.saveShapeInfo = function() {\r\n            var shape = vm.canvas.getActiveObject();\r\n            console.log(shape);\r\n            shape.label = $('#label').val();\r\n            shape.comment = $('#comment').val();\r\n            vm.updateDesign();\r\n            vm.saveCanvas();\r\n        };\r\n        vm.connectToSocket = function(){\r\n            var pathArray = location.pathname.split('/');\r\n            socket = io('/' + pathArray[1], {query: 'room=' + pathArray[2] + '&name=' + vm.currentName});\r\n            \r\n            socket.on('updateGroup', function(msg) {\r\n                console.log(msg); \r\n                var messages = $('#messages');\r\n                var date = new Date();\r\n                var postfix = (date.getHours() >= 12) ? 'pm' : 'am';\r\n                var hours = date.getHours() - (date.getHours() > 12 ? 12 : 0);\r\n                var minutes = (date.getMinutes() >= 10) ? date.getMinutes() : '0' + date.getMinutes();\r\n                var time = hours + ':' + minutes + postfix;\r\n                messages.append($('<li class=\"message\">').html(\"<p class='msgTime'>\" + time + \"</p>\" + \"<p class='userJoinedMessage'>\" + msg + \"</p>\"));\r\n                messages.scrollTop(messages[0].scrollHeight);\r\n                if($('.chatBodyContainer').css('display') == 'none') {\r\n                    $('.chatHeader').addClass('notification');\r\n                }\r\n            });\r\n            socket.on('designUpdate', function(design) {\r\n                if(!vm.viewOnly) {\r\n                    console.log(design);\r\n                    fabric.util.enlivenObjects([JSON.parse(design.shape)], function(object) {\r\n                        vm.canvas.insertAt(object[0],design.index, true);\r\n                        vm.canvas.renderAll();\r\n\r\n                    });\r\n                    \r\n                    \r\n                } else {\r\n                    fabric.util.enlivenObjects([JSON.parse(design.shape)], function(object) {\r\n                        object.set('selectable', false);\r\n                        vm.canvas.insertAt(object[0],design.index, true);\r\n                    });\r\n                    vm.canvas.renderAll();\r\n                }\r\n                vm.updateState();\r\n            }); \r\n            socket.on('shapeToAdd', function(shape) {\r\n                if(!vm.viewOnly) {\r\n                    \r\n                    fabric.util.enlivenObjects([JSON.parse(shape.shape)], function(object) {\r\n                        vm.canvas.add(object[0]);\r\n                        vm.canvas.renderAll();\r\n                    });\r\n                    \r\n                } else {\r\n                    fabric.util.enlivenObjects([JSON.parse(shape.shape)], function(object) {\r\n                        object.set('selectable', false);\r\n                        vm.canvas.insertAt(object[0],shape.index, true);\r\n                    });\r\n                    vm.canvas.renderAll();\r\n                }\r\n                vm.updateState();\r\n            });\r\n            socket.on('shapeToRemove', function(toRemove) {\r\n                if(!vm.viewOnly) {\r\n                    \r\n                    fabric.util.enlivenObjects([JSON.parse(toRemove.shape)], function(object) {\r\n                        vm.canvas.insertAt(object[0],toRemove.index, true);\r\n                        vm.canvas.remove(object[0]);\r\n                        vm.canvas.renderAll();\r\n\r\n                    });\r\n                    \r\n                } else {\r\n                    fabric.util.enlivenObjects([JSON.parse(toRemove.shape)], function(object) {\r\n                        vm.canvas.insertAt(object[0],toRemove.index, true);\r\n                        vm.canvas.remove(object[0]);\r\n                    });\r\n                    vm.canvas.renderAll();\r\n                }\r\n                vm.updateState();\r\n            });\r\n            socket.on('messageRecieved', function(msg) {\r\n                var messages = $('#messages');\r\n                var date = new Date();\r\n                var postfix = (date.getHours() >= 12) ? 'pm' : 'am';\r\n                var hours = date.getHours() - (date.getHours() > 12 ? 12 : 0);\r\n                var minutes = (date.getMinutes() >= 10) ? date.getMinutes() : '0' + date.getMinutes();\r\n                var time = hours + ':' + minutes + postfix;\r\n                messages.append($('<li class=\"message\">').html(\"<p class='messageName'>\" + msg.name + \"</p>\" + \"<p class='msgTime'>\" + time + \"</p>\"  + \"<p class='msgText'>\" + msg.message + \"</p>\"));\r\n                messages.scrollTop(messages[0].scrollHeight);\r\n                if($('.chatBodyContainer').css('display') == 'none') {\r\n                    $('.chatHeader').addClass('notification');\r\n                }\r\n            });\r\n        }\r\n        vm.copy = function() {\r\n            if(vm.canvas.getActiveGroup()){\r\n                for(var i in vm.canvas.getActiveGroup().objects){\r\n                    var object = fabric.util.object.clone(vm.canvas.getActiveGroup().objects[i]);\r\n                    object.set(\"top\", object.top+5);\r\n                    object.set(\"left\", object.left+5);\r\n                    vm.copiedObjects[i] = object;\r\n                }                    \r\n            }\r\n            else if(vm.canvas.getActiveObject()){\r\n                var object = fabric.util.object.clone(vm.canvas.getActiveObject());\r\n                object.set(\"top\", object.top+5);\r\n                object.set(\"left\", object.left+5);\r\n                vm.copiedObject = object;\r\n                vm.copiedObjects = new Array();\r\n            }\r\n        }\r\n        vm.paste = function() {\r\n            if(vm.copiedObjects.length > 0){\r\n                for(var i in vm.copiedObjects){\r\n                    vm.canvas.add(vm.copiedObjects[i]);\r\n                }                    \r\n            }\r\n            else if(vm.copiedObject){\r\n                vm.canvas.add(vm.copiedObject);\r\n                vm.updateDesign();\r\n            }\r\n            vm.canvas.renderAll(); \r\n            vm.updateState();\r\n            vm.saveCanvas();\r\n        }\r\n        vm.undo = function() {\r\n            if(vm.mods < vm.state.length) {\r\n                var index = vm.state.length - 1 - vm.mods - 1;\r\n                if(index > -1) {\r\n                    vm.canvas.clear().renderAll();\r\n                    vm.canvas.loadFromJSON(vm.state[index]);\r\n                    vm.canvas.renderAll();\r\n                    vm.mods += 1;\r\n                    vm.saveCanvas();\r\n                }\r\n            }\r\n        }\r\n        vm.redo = function() {\r\n            if(vm.mods > 0) {\r\n                vm.canvas.clear().renderAll();\r\n                vm.canvas.loadFromJSON(vm.state[vm.state.length - 1 - vm.mods + 1]);\r\n                vm.canvas.renderAll();\r\n                vm.mods -= 1;\r\n                vm.saveCanvas();\r\n            }\r\n        }\r\n        vm.sendMessage = function() {\r\n            if($('#m').val() != '') {\r\n                vm.message = {name: vm.currentName, message: $('#m').val()};\r\n                $('#m').val('');\r\n                socket.emit('sendMessage', vm.message);\r\n            }\r\n        }\r\n        function regularPolygonPoints(sideCount, radius) {\r\n            var sweep = Math.PI*2/sideCount;\r\n            var cx = radius; \r\n            var cy = radius;\r\n            var points = [];\r\n            for(var i = 0; i < sideCount; i++) {\r\n                var x = cx+radius*Math.cos(i*sweep);\r\n                var y = cy+radius*Math.sin(i*sweep);\r\n                points.push({x:x, y:y});\r\n            }\r\n            return points;\r\n        }\r\n        document.addEventListener('keydown', function(event) {\r\n            switch (event.keyCode) {\r\n                case 46:\r\n                    if(vm.canvas.getActiveObject()) {\r\n                        var shapeToRemove = vm.canvas.getActiveObject();\r\n                        vm.updateShapeDeletion();\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.renderAll();\r\n                        vm.updateState();\r\n                        vm.saveCanvas();\r\n                        return;\r\n                    }\r\n                    break;\r\n                case 16:\r\n                    vm.keepSquare = true;\r\n                    break;\r\n                case 67:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.copy();\r\n                    }\r\n                    break;\r\n                case 86:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.paste();\r\n                    }\r\n                    break;\r\n                case 90:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.undo();\r\n                    }\r\n                    break;\r\n                case 89:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.redo();\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n        document.addEventListener('keyup', function(event) {\r\n            if(event.target.type == 'text' || event.target.id == 'comment' || event.target.id == 'textValue') return false;\r\n            switch( event.keyCode) {\r\n                case 16: \r\n                    vm.keepSquare = false;\r\n                    break;\r\n                case 86:\r\n                case 27:\r\n                    if(!event.ctrlKey) vm.changeToPointer();\r\n                    break;\r\n                case 84:\r\n                    vm.changeToText();\r\n                    break;\r\n                case 83:\r\n                    vm.changeToRect();\r\n                    break;\r\n                case 80:\r\n                    vm.changeToPolygon();\r\n                    break;\r\n                case 69:\r\n                    vm.changeToEllipse();\r\n                    break;\r\n                case 73:\r\n                    vm.changeToImgShape();\r\n                    break;\r\n                case 76:\r\n                    vm.changeToLine();\r\n                    break;\r\n                case 82:\r\n                    vm.changeToTriangle();\r\n                    break;\r\n                    \r\n            }\r\n        });\r\n        vm.updateState = function() {\r\n            var canvasJson = vm.canvas.toDatalessJSON(['label','comment']);\r\n            var canvasString = JSON.stringify(canvasJson);\r\n            vm.state.push(canvasString);\r\n\r\n        }\r\n        vm.saveCanvas = function() {\r\n            var canvasJson = vm.canvas.toDatalessJSON(['label','comment']);\r\n            var canvasString = JSON.stringify(canvasJson);\r\n            vm.currentEmail = authentication.currentUser().email;\r\n            vm.design = {\r\n                id: vm.designId,\r\n                owner: vm.currentEmail,\r\n                design: canvasString\r\n            }\r\n            meanData.saveDesign(vm.design)\r\n                .success(function(data) {\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        }\r\n        vm.updateDesign = function() {\r\n            var toUpdate = {index: vm.canvas.getObjects().indexOf(vm.canvas.getActiveObject()), shape: JSON.stringify(vm.canvas.getActiveObject().toDatalessObject(['label','comment']))};\r\n            console.log(toUpdate);\r\n            socket.emit('updateDesign', toUpdate);\r\n        };\r\n        vm.updateShapeDeletion = function() {\r\n            var toDelete = {index: vm.canvas.getObjects().indexOf(vm.canvas.getActiveObject()), shape: JSON.stringify(vm.canvas.getActiveObject().toDatalessObject())};\r\n            socket.emit('deleteShape', toDelete);\r\n        }\r\n        vm.shapeAdded = function() {\r\n            var toAdd = {shape: JSON.stringify(vm.canvas.getActiveObject().toDatalessObject(['label','comment']))};\r\n            console.log(toAdd);\r\n            socket.emit('addShape', toAdd);\r\n        };\r\n        vm.setCanvasSize = function(size) {\r\n            vm.canvas.setWidth(size.width);\r\n            vm.canvas.setHeight(size.height);\r\n\r\n        };\r\n        vm.changeToRect = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'rect';\r\n            $('#rect').addClass('selectedButton'); \r\n            vm.canvas.defaultCursor = 'crosshair';\r\n            vm.canvas.discardActiveObject().renderAll();\r\n        };\r\n        vm.changeToEllipse = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'ellipse';\r\n            $('#ellipse').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n            vm.canvas.discardActiveObject().renderAll();\r\n        };\r\n        vm.changeToTriangle = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'triangle';\r\n            $('#triangle').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n            vm.canvas.discardActiveObject().renderAll();\r\n        };\r\n        \r\n        vm.changeToText = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'i-text';\r\n            $('#i-text').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n            vm.canvas.discardActiveObject().renderAll();\r\n        };\r\n        vm.changeToImgShape = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'image';\r\n            $('#image').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n            vm.canvas.discardActiveObject().renderAll();\r\n        };\r\n        vm.changeToPolygon = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'polygon';\r\n            $('#polygon').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n            vm.canvas.discardActiveObject().renderAll();\r\n        };\r\n        vm.changeToPointer = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'pointer';\r\n            $('#pointer').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'default';\r\n        };\r\n        vm.changeToLine = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'line';\r\n            $('#line').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n            vm.canvas.discardActiveObject().renderAll();\r\n        };\r\n        $scope.toggleChat = function() {\r\n            if($('.chatBodyContainer').css('display') == 'inline-block') {\r\n                $('.chatBodyContainer').css('display','none');  \r\n            } else {\r\n                $('.chatBodyContainer').css('display' ,'inline-block');\r\n                $('.chatHeader').removeClass('notification');\r\n            }\r\n        }\r\n        vm.setUpCanvas = function() {\r\n            document.getElementById('exportLink').addEventListener('click', function(e) {\r\n                if(!fabric.Canvas.supports('toDataURL')) {\r\n                    alert('This browlser doesn\\'t support exporting')\r\n                } else {\r\n                    this.href = vm.canvas.toDataURL();\r\n                    this.download = vm.designName.replaceAll(' ', '_') + '.png';\r\n                }\r\n            });\r\n            vm.canvas.on('mouse:down', function(event) {\r\n                if(!vm.drawingMode || vm.viewOnly || vm.shapeType == 'pointer') return;\r\n                vm.isDown = true;\r\n                vm.startPosition.x = event.e.offsetX - 5;\r\n                vm.startPosition.y = event.e.offsetY - 5;\r\n                vm.drawingMode = false;\r\n                DrawingService.createShape({\r\n                    shapeType: vm.shapeType,\r\n                    startPosition: vm.startPosition\r\n                }, function(shape) {\r\n                    vm.shape = shape;\r\n                    vm.canvas.add(vm.shape);\r\n                    vm.canvas.renderAll();\r\n                    vm.drawingMode = true;\r\n                });\r\n\r\n            });\r\n            vm.canvas.on('mouse:move', function(event) {\r\n                var deltaX, deltaY;\r\n                if(!vm.isDown || !vm.drawingMode || vm.viewOnly || vm.shapeType == 'pointer') return;\r\n                switch(vm.shapeType) {\r\n                    case 'rect':\r\n                        if(vm.keepSquare) {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = deltaX;\r\n                        } else {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        }\r\n\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'ellipse':\r\n                        var rx = Math.abs(vm.startPosition.x - event.e.offsetX) / 2;\r\n                        var ry = Math.abs(vm.startPosition.y - event.e.offsetY) / 2;\r\n                        if( rx > vm.shape.strokeWidth) {\r\n                            rx -= vm.shape.strokeWidth / 2;\r\n                        }                \r\n                        if( ry > vm.shape.strokeWidth) {\r\n                            ry -= vm.shape.strokeWidth / 2;\r\n                        }\r\n                        vm.shape.set({rx: rx, ry: ry});\r\n\r\n                        if(vm.startPosition.x > event.e.offsetX) {\r\n                            vm.shape.set({originX: 'right'});\r\n                        } else {\r\n                            vm.shape.set({originX: 'left'});\r\n                        }\r\n                        if(vm.startPosition.y > event.e.offsetY) {\r\n                            vm.shape.set({originY: 'bottom'});\r\n                        } else {\r\n                            vm.shape.set({originY: 'top'});\r\n                        }\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'triangle':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'polygon':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        var radius = (deltaX / 2) - 4;\r\n                        vm.shape.set({points: regularPolygonPoints(6, radius)});\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.set('left', vm.startPosition.x);\r\n                        vm.shape.set('top', vm.startPosition.y);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'i-text':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.set('left', vm.startPosition.x);\r\n                        vm.shape.set('top', vm.startPosition.y);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'image':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        \r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        \r\n                        //var boundingRect = vm.shape.getBoundingRect();\r\n//                        vm.shape.set('left', vm.startPosition.x);\r\n//                        vm.shape.set('top', vm.startPosition.y);\r\n//                        vm.shape.setObjectsCoords();\r\n                        break;\r\n                    case 'line':\r\n                        vm.shape.set({x2: event.e.offsetX, y2: event.e.offsetY});\r\n                        break;\r\n                }\r\n                vm.canvas.renderAll();\r\n            });\r\n            vm.canvas.on('mouse:up', function(event) {\r\n                vm.isDown = false;\r\n\r\n                if(vm.drawingMode && vm.shapeType != 'pointer') {\r\n                    if(vm.shapeType === 'rect') {\r\n                        if(event.e.offsetY - vm.startPosition.y < 0) {\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    } else if(vm.shapeType === 'triangle') {\r\n                        if(vm.offsetY - vm.startPosition.y < 0) {\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.rotate(180);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    } else if(vm.shapeType === 'image') {\r\n//                        vm.shape.setWidth(vm.shape._objects[0].width);\r\n//                        vm.shape.setHeight(vm.shape._objects[0].height);\r\n//                        vm.shape.setCoords();\r\n//                        vm.canvas.renderAll();\r\n                    } else if(vm.shapeType === 'line') {\r\n//                        vm.shape.hasBorders = false;\r\n//                        vm.shape.setControlsVisibility({bl:false, mb:false, ml:false, mr:false, mt:false, tr:false, mtr:false});\r\n//                        vm.shape.lockUniScaling = false;\r\n                    }\r\n                    vm.canvas.setActiveObject(vm.shape);\r\n                    vm.updateState();\r\n                    vm.shapeAdded();\r\n                    console.log('calling save canvas from mouse up');\r\n                    vm.saveCanvas();\r\n                } \r\n                vm.drawingMode = false;\r\n            });\r\n            vm.canvas.on('selection:cleared', function() {\r\n                $('#textOptions').css('display', 'none');\r\n                console.log(document.getElementById('shapeInfoDiv'));\r\n                document.getElementById('shapeInfoDiv').style.display = 'none';\r\n            });\r\n            vm.canvas.on('object:selected', function() {\r\n                if(!vm.viewOnly) {\r\n                    vm.drawingMode = false;\r\n                    var shape = vm.canvas.getActiveObject();\r\n                    $('#' + vm.shapeType).removeClass('selectedButton');\r\n                    $('#' + vm.shapeType).addClass('selectedButton');\r\n                    if(shape.type === 'i-text') {\r\n                        vm.textOptions.text = shape.text;\r\n                        vm.textOptions.fontFamily = shape.fontFamily;\r\n                        vm.textOptions.fontSize = shape.fontSize;\r\n                        vm.textOptions.textAlign = shape.textAlign;\r\n                        $scope.$apply();\r\n                        $('#font-family select').val(shape.fontFamily);\r\n                        $('#font-size').val(shape.fontSize);\r\n\r\n                        $('#textOptions').css('display', 'inline-block');\r\n                        $('#textValue').bind('change keyup', function() {\r\n                            vm.canvas.getActiveObject().text = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#font-family').change(function() {\r\n                            vm.canvas.getActiveObject().fontFamily = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#font-size').change(function() {\r\n                           vm.canvas.getActiveObject().fontSize = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#font-align').change(function() {\r\n                            vm.canvas.getActiveObject().fontAlign = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#toggleBold').on('click', function() {\r\n                             vm.canvas.getActiveObject().fontWeight = (vm.canvas.getActiveObject().fontWeight === 'bold') ? 'normal' : 'bold';\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#toggleItalic').on('click', function() {\r\n                            vm.canvas.getActiveObject().fontStyle = (vm.canvas.getActiveObject().fontStyle === 'italic') ? 'normal' : 'italic';\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n\r\n                        });\r\n                        $('#toggleUnderline').on('click', function() {\r\n                            vm.canvas.getActiveObject().textDecoration = (vm.canvas.getActiveObject().textDecoration === 'underline') ? '' : 'underline';\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#toggleLinethrough').on('click', function() {\r\n                            vm.canvas.getActiveObject().textDecoration = (vm.canvas.getActiveObject().textDecoration === 'line-through') ? '' : 'line-through';\r\n                            vm.canvas.renderAll();\r\n                            vm.updateDesign();\r\n                            vm.updateState();\r\n                            vm.saveCanvas();\r\n                        });\r\n                    } else {\r\n                        $('#textOptions').css('display', 'none');\r\n                    }\r\n                }\r\n            });\r\n            vm.canvas.on('mouse:over', function(e) {\r\n                if(e.target && vm.shapeType != 'pointer') {\r\n                    console.log('false selection');\r\n                    e.target.set('selectable',false);\r\n                } else if(e.target && vm.shapeType == 'pointer') {\r\n                    console.log('make selectable again');\r\n                    e.target.set('selectable', true);\r\n                }\r\n                \r\n            });\r\n            vm.canvas.on('object:moving', function() {\r\n                vm.saveCanvas(); \r\n                vm.updateDesign();\r\n            });\r\n            vm.canvas.on('object:scaling', function() {\r\n//                vm.saveCanvas(); \r\n//                vm.updateDesign();\r\n\r\n            });\r\n            vm.canvas.on('object:rotating', function() {\r\n//                vm.saveCanvas(); \r\n//                vm.updateDesign();\r\n\r\n            });\r\n            vm.canvas.on('selection:cleared', function() {\r\n                vm.drawingMode = true;\r\n            });\r\n    \r\n            vm.canvas.observe('object:modified', function(e) {\r\n                console.log('object modified');\r\n                e.target.resizeToScale();\r\n                vm.updateState();\r\n                vm.updateDesign();\r\n                vm.saveCanvas();\r\n                \r\n            });\r\n            vm.openModal = function() {\r\n                console.log('modal opened');\r\n                $('.shareModal').css('display','block');\r\n            };\r\n            vm.closeModal = function() {\r\n                $('.shareModal').css('display', 'none');\r\n            };\r\n            vm.shareDesign = function() {\r\n                if(!vm.viewOnly) {\r\n                meanData.shareDesign(vm.shareInfo)\r\n                    .success(function(data){\r\n                        vm.closeModal();\r\n                        alert('Project shared');\r\n                    })\r\n                    .error(function(e) {\r\n                        console.log(e);\r\n                    });\r\n                }\r\n            };\r\n\r\n            fabric.Object.prototype.resizeToScale = function() {\r\n                switch(this.type) {\r\n                    case 'rect':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1; \r\n                        break;\r\n                    case 'ellipse':\r\n                        this.rx *= this.scaleX;\r\n                        this.ry *= this.scaleY;\r\n                        this.width = this.rx * 2;\r\n                        this.height = this.ry * 2;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'triangle':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'polyline':\r\n                    case 'polygon':\r\n//                        var points = this.get('points');\r\n//                        for (var i = 0; i < points.length; i++) {\r\n//                            var p = points[i];\r\n//                            p.x *= this.scaleX;\r\n//                            p.y *= this.scaleY;\r\n//                        }\r\n//                        this.scaleX = 1;\r\n//                        this.scaleY = 1;\r\n//                        this.width = this.getBoundingBox().width;\r\n//                        this.height = this.getBoundingBox().height;\r\n                        break;\r\n                    case 'image':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        vm.init();\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('homeCtrl', homeCtrl);\r\n    \r\n    function homeCtrl() {\r\n        console.log('home controller is running');\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('profileCtrl', profileCtrl);\r\n    profileCtrl.$inject = ['$location', 'meanData', 'authentication', '$scope'];\r\n    function profileCtrl($location, meanData, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        vm.user = {};\r\n        vm.designs = {};\r\n        vm.sharedDesigns = {};\r\n        vm.currentEmail = authentication.currentUser().email;\r\n        vm.design = {\r\n            title: '',\r\n            owner: vm.currentEmail,\r\n            design: '',\r\n            size: ''\r\n        };\r\n        meanData.getProfile()\r\n            .success(function(data) {\r\n                vm.user = data;\r\n                console.log(vm.user.email);\r\n                meanData.getDesigns(vm.user.email)\r\n                    .success(function(data) {\r\n                        console.log(data);\r\n                        vm.designs = data.designs;\r\n                        meanData.getSharedDesigns(vm.user.email)\r\n                            .success(function(data) {\r\n                            vm.sharedDesigns = data.sharedDesigns;\r\n                        })\r\n                        .error( function(e) {\r\n                            console.log(e);\r\n                        });\r\n                    })\r\n                    .error( function(e) {\r\n                        console.log(e);\r\n                    });\r\n            })\r\n            .error( function(e) {\r\n                console.log(e);\r\n            });\r\n        vm.openModal = function() {\r\n            console.log('modal opened');\r\n            $('.designModal').css('display','block');\r\n        };\r\n        $scope.openDiv = function(value) {\r\n            console.log(value);\r\n            if(value === 'custom') {\r\n                console.log('yay custom');\r\n                document.getElementById('customSizeDiv').style.display = 'block';\r\n                document.getElementById('width').required = true;\r\n                document.getElementById('height').required = true;\r\n                \r\n            } else {\r\n                console.log('no custom');\r\n                document.getElementById('customSizeDiv').style.display = 'none';\r\n                document.getElementById('height').required = false;\r\n                document.getElementById('width').required = false;\r\n\r\n            }\r\n        };\r\n        vm.closeModal = function() {\r\n            $('.designModal').css('display', 'none');\r\n        };\r\n        vm.timeSince = function(date) {\r\n            var oldDate = new Date(date);\r\n            var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\n             return monthNames[oldDate.getMonth()] + ' ' + oldDate.getDate() + ', ' + oldDate.getFullYear();\r\n        };\r\n        vm.submitNewDesign = function() {\r\n            if(vm.design.size === 'Large') {\r\n                vm.design.size = {width: 1500, height:1000};\r\n            } else if(vm.design.size === 'Medium') {\r\n                vm.design.size = {width: 800, height: 800};\r\n            } else if(vm.design.size === 'Small') {\r\n                vm.design.size = {width: 400, height: 600};\r\n            } else if(vm.design.size === 'Custom') {\r\n                vm.design.size = {width: document.getElementById('width').value, height: document.getElementById('height').value};\r\n            }\r\n            meanData.createDesign(vm.design)\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                })\r\n                .success(function(data){\r\n                    console.log('in controller');\r\n                    console.log(data);\r\n                    $location.path('/design/' + data.id);\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('loginCtrl', loginCtrl);\r\n    \r\n    loginCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function loginCtrl($location, authentication,$scope) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            email: '',\r\n            password: ''\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            authentication\r\n                .login(vm.credentials)\r\n                .error(function(err) {\r\n                    console.log(err);\r\n                    $scope.error = err.message;\r\n//                    $scope.$apply();\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular.module('app')\r\n        .factory('DrawingService', DrawingService);\r\n    \r\n    DrawingService.$inject = ['ShapeService'];\r\n    function DrawingService(ShapeService) {\r\n        \r\n        var drawingFactory = {};\r\n        \r\n        drawingFactory.createShape = function(options, callback) {\r\n            var parentClass = null;\r\n            console.log(options.shapeType);\r\n            if(options.shapeType === 'rect') {\r\n                parentClass = ShapeService.createRect;\r\n            } else if(options.shapeType === 'ellipse') {\r\n                parentClass = ShapeService.createEllipse;\r\n            } else if(options.shapeType === 'triangle') {\r\n                parentClass = ShapeService.createTriangle;\r\n            } else if(options.shapeType === 'image') {\r\n                parentClass = ShapeService.createImgShape;\r\n            } else if(options.shapeType === 'i-text') {\r\n                parentClass = ShapeService.createText;\r\n            } else if(options.shapeType === 'polygon') {\r\n                parentClass = ShapeService.createPolygon;\r\n            } else if(options.shapeType === 'line') {\r\n                parentClass = ShapeService.createLine;\r\n            }\r\n            \r\n            new parentClass(options, function(shape) {\r\n                callback(shape);\r\n            });\r\n        }\r\n        return drawingFactory;\r\n    };\r\n})();\n(function() {\r\n    angular.module('app')\r\n            .factory('ShapeService', ShapeService);\r\n    \r\n    function ShapeService() {\r\n        \r\n        var shapeFactory = {};\r\n        \r\n        shapeFactory.createRect = function(options, callback) {\r\n            var rect = new fabric.Rect({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                stroke:'black',\r\n                strokeWidth:1,\r\n                fill:'transparent'\r\n            });\r\n            rect.shapeInfo = {};\r\n            rect.label = '';\r\n            rect.comment = '';\r\n            callback(rect);\r\n        }\r\n        shapeFactory.createEllipse = function(options, callback) {\r\n            var ellipse = new fabric.Ellipse({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                originX: 'left',\r\n                originY: 'top',\r\n                rx: 0,\r\n                ry: 0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1                \r\n            });\r\n            ellipse.label = '';\r\n            ellipse.comment = '';\r\n\r\n            callback(ellipse);\r\n        }\r\n        shapeFactory.createTriangle = function(options, callback) {\r\n            var triangle = new fabric.Triangle({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1            \r\n            });\r\n            triangle.label = '';\r\n            triangle.comment = '';\r\n\r\n            callback(triangle);\r\n        }\r\n        shapeFactory.createText = function(options, callback) {\r\n            var text = new fabric.IText(\"Text\", {\r\n                top: options.startPosition.y,\r\n                left: options.startPosition.x,\r\n                fontSize: 18\r\n            });\r\n            text.label = '';\r\n            text.comment = '';\r\n\r\n            callback(text);\r\n        }\r\n        shapeFactory.createImgShape = function(params, callback) {\r\n//            var group = [];\r\n//            fabric.loadSVGFromURL('svgs/imageShape.svg', function(objects, options) {\r\n//                var loadedObjects = new fabric.Group(group);\r\n//                loadedObjects.set({\r\n//                    left: params.startPosition.x,\r\n//                    top: params.startPosition.y,\r\n//                    fill: 'transparent',\r\n//                    stroke: 'black',\r\n//                    originX: 'left',\r\n//                    originY: 'top',\r\n//                    strokeWidth: 1,\r\n//                    type: 'imgShape',\r\n//                });\r\n//                console.log(loadedObjects);\r\n//                loadedObjects.label = '';\r\n//                loadedObjects.comment = '';\r\n//\r\n//                callback(loadedObjects);\r\n//            },\r\n//            function(item, object) {\r\n//                object.set('id', item.getAttribute('id'));\r\n//                group.push(object);\r\n//            });\r\n            var oSVG;\r\n            fabric.Image.fromURL('svgs/imageShape.svg', function(object) {\r\n                oSVG = object.set({left: params.startPosition.x,\r\n                                  top: params.startPosition.y,\r\n                                  fill: 'transparent',\r\n                                  stroke: 'black',\r\n                                  originX: 'left',\r\n                                  originY: 'top',\r\n                                  strokeWidth: 1,\r\n                                   width: 0,\r\n                                   height: 0\r\n                                  });\r\n                oSVG.label = '';\r\n                oSVG.comment = '';\r\n                callback(oSVG);\r\n            })\r\n        }\r\n        shapeFactory.createLine = function(params, callback) {\r\n            var points = [params.startPosition.x,params.startPosition.y,params.startPosition.x, params.startPosition.y];\r\n            console.log(points);\r\n            var line = new fabric.Line(points, {\r\n                strokeWidth: 3,\r\n                fill: 'black',\r\n                stroke: 'black',\r\n                originX: 'center',\r\n                originY: 'center'\r\n            });\r\n            line.label = '';\r\n            line.comment = '';\r\n\r\n            callback(line);\r\n        }\r\n        shapeFactory.createPolygon = function(params, callback) {\r\n            var points = regularPolygonPoints(6,5);\r\n            var polygon = new fabric.Polygon(points, {\r\n                stroke: 'black',\r\n                left: params.startPosition.x,\r\n                top: params.startPosition.y,\r\n                strokeWidth: 2,\r\n                fill:'transparent'\r\n            }, false);\r\n            polygon.label = '';\r\n            polygon.comment = '';\r\n\r\n            callback(polygon);\r\n        }\r\n        function regularPolygonPoints(sideCount, radius) {\r\n            var sweep = Math.PI*2/sideCount;\r\n            var cx = radius;\r\n            var cy = radius;\r\n            var points = [];\r\n            for(var i = 0; i < sideCount; i++) {\r\n                var x = cx+radius*Math.cos(i*sweep);\r\n                var y = cy+radius*Math.sin(i*sweep);\r\n                points.push({x:x, y:y});\r\n            }\r\n            return points;\r\n        }\r\n        return shapeFactory;\r\n    };\r\n    \r\n    \r\n})();\n(function() {\r\n    \r\n    angular\r\n        .module('app')\r\n        .controller('registerCtrl', registerCtrl);\r\n    registerCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function registerCtrl($location, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            name: \"\",\r\n            email: \"\",\r\n            password: \"\"\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            console.log('submitting registration');\r\n            authentication\r\n                .register(vm.credentials)\r\n                .error(function(err) {\r\n                    $scope.error = err.message;\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .service('authentication', authentication);\r\n    \r\n    authentication.$inject = ['$http', '$window'];\r\n    function authentication($http, $window) {\r\n        var saveToken = function(token) {\r\n            $window.localStorage['mean-token'] = token;\r\n        };\r\n        \r\n        var getToken = function() {\r\n            return $window.localStorage['mean-token'];\r\n        };\r\n        \r\n        logout = function() {\r\n            $window.localStorage.removeItem('mean-token');\r\n        };\r\n        \r\n        var isLoggedIn = function() {\r\n            var token = getToken();\r\n            var payload;\r\n            \r\n            if(token) {\r\n                payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                \r\n                return payload.exp > Date.now() / 1000;\r\n            } else {\r\n                return false;\r\n            }\r\n        };\r\n        var currentUser = function() {\r\n            if(isLoggedIn()) {\r\n                var token = getToken();\r\n                var payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                return {\r\n                    email: payload.email,\r\n                    name: payload.name\r\n                };\r\n            }\r\n        };\r\n        register = function(user) {\r\n            return $http.post('/api/register', user).success(function(data) {\r\n                saveToken(data.token);\r\n            })\r\n            .error(function(e) {\r\n            \r\n            });\r\n        };\r\n        login = function(user) {\r\n            return $http.post('/api/login', user).success(function(data) {\r\n                saveToken(data.token);\r\n            });\r\n        };\r\n        return {\r\n            saveToken: saveToken,\r\n            getToken: getToken,\r\n            logout: logout,\r\n            isLoggedIn: isLoggedIn,\r\n            currentUser: currentUser,\r\n            register: register,\r\n            login: login,\r\n            logout: logout\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .service('meanData', meanData);\r\n    \r\n    meanData.$inject = ['$http', 'authentication', '$location'];\r\n    function meanData($http, authentication, $location) {\r\n        var getProfile = function() {\r\n            console.log(authentication.getToken());\r\n            return $http.get('/api/profile', {\r\n                headers: {\r\n                    Authorization: 'Bearer ' + authentication.getToken()\r\n                }\r\n            });\r\n        };\r\n        var getDesigns = function(email) {\r\n            console.log(email);\r\n            return $http.get('/api/designs', {params: {email: email}})\r\n                .success(function(data) {\r\n                    console.log(data);   \r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        };\r\n        var getSharedDesigns = function(email) {\r\n            return $http.get('api/designs/shared', {params: {email: email}})\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        };\r\n        var getDesign = function(designId) {\r\n            return $http.get('/api/design', {params: {id: designId, email: authentication.currentUser().email}})\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e)\r\n                });\r\n        };\r\n        var saveDesign = function(design) {\r\n              return $http.post('/api/designs/save', design)\r\n                    .success(function(data) {\r\n                  console.log(data);\r\n              });\r\n        };\r\n        var createDesign = function(design) {\r\n            return $http.post('/api/designs/save', design)\r\n                .success(function(data) {\r\n                  console.log('in data service');\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n            \r\n        };\r\n        var shareDesign = function(shareInfo) {\r\n              return $http.post('api/designs/share', shareInfo)\r\n                .success(function(data) {\r\n                  console.log('in mean data');\r\n                })\r\n                .error(function(e) {\r\n                  console.log(e);\r\n                });\r\n        };\r\n        \r\n        return {\r\n            getProfile: getProfile,\r\n            getDesigns: getDesigns,\r\n            getSharedDesigns: getSharedDesigns,\r\n            saveDesign: saveDesign,\r\n            getDesign: getDesign,\r\n            createDesign: createDesign,\r\n            shareDesign: shareDesign\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('navigationCtrl', navigationCtrl);\r\n    navigationCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function navigationCtrl($location, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        $scope.isLoggedIn = function() {\r\n            return authentication.isLoggedIn();\r\n        }\r\n        $scope.currentUser = function() {\r\n            if($scope.isLoggedIn()) {\r\n                return authentication.currentUser().name;\r\n            }\r\n        }\r\n        console.log($scope.isLoggedIn());\r\n        $scope.logOut = function() {\r\n            authentication.logout();\r\n            $location.path('/');\r\n        }\r\n    }\r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .directive('navigation', navigation);\r\n    \r\n    function navigation() {\r\n        return {\r\n            restrict: 'A',\r\n            templateUrl: '/common/directives/navigation/navigation.template.html',\r\n            controller: 'navigationCtrl as navvm'\r\n        };\r\n    }\r\n})();"]}