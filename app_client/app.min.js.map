{"version":3,"sources":["app.min.js"],"names":["config","$routeProvider","$locationProvider","when","templateUrl","controller","controllerAs","otherwise","redirectTo","html5Mode","run","$rootScope","$location","authentication","$on","event","nextRoute","currentRoute","path","isLoggedIn","angular","module","designCtrl","$scope","DrawingService","meanData","$routeParams","regularPolygonPoints","sideCount","radius","sweep","Math","PI","cx","vm","shape","get","cy","points","i","x","cos","y","sin","push","this","designId","currentUser","currentEmail","email","currentName","name","shareInfo","id","permission","textOptions","text","fontFamily","fontSize","textAlign","copiedObject","copiedObjects","Array","state","mods","shapeType","drawingMode","isDown","startPosition","viewOnly","canvas","init","connectToSocket","console","log","fabric","Canvas","renderOnAddRemove","selection","setUpCanvas","getDesign","success","data","setCanvasSize","design","size","canvasDesign","loadFromJSON","renderAll","bind","o","object","set","updateState","designName","title","error","e","location","pathname","toString","pathArray","split","socket","io","query","on","msg","messages","$","date","Date","postfix","getHours","hours","minutes","getMinutes","time","append","html","message","scrollTop","scrollHeight","copy","getActiveGroup","objects","util","clone","top","left","getActiveObject","paste","length","add","saveCanvas","undo","index","clear","redo","sendMessage","val","emit","document","addEventListener","keyCode","shapeToRemove","remove","keepSquare","ctrlKey","preventDefault","canvasJson","toJSON","canvasString","JSON","stringify","owner","saveDesign","setWidth","width","setHeight","height","changeToRect","removeClass","addClass","defaultCursor","changeToEllipse","changeToTriangle","changeToText","changeToImgShape","changeToPolygon","changeToPointer","changeToLine","toggleChat","css","getElementById","supports","href","toDataURL","format","quality","download","alert","offsetX","offsetY","createShape","deltaX","deltaY","setCoords","rx","abs","ry","strokeWidth","originX","originY","_objects","forEach","item","getBoundingRect","oCoords","setObjectsCoords","x2","y2","getHeight","rotate","setTransformMatrix","setActiveObject","type","$apply","value","change","fontAlign","fontWeight","fontStyle","textDecoration","observe","target","resizeToScale","openModal","closeModal","shareDesign","Object","prototype","scaleX","scaleY","$inject","homeCtrl","profileCtrl","user","designs","sharedDesigns","getProfile","getDesigns","getSharedDesigns","openDiv","style","display","required","timeSince","oldDate","monthNames","getMonth","getDate","getFullYear","submitNewDesign","createDesign","loginCtrl","credentials","password","onSubmit","login","err","then","registerCtrl","register","ShapeService","drawingFactory","options","callback","parentClass","createRect","createEllipse","createTriangle","createImgShape","createText","createPolygon","createLine","factory","shapeFactory","rect","Rect","stroke","fill","ellipse","Ellipse","triangle","Triangle","IText","params","group","loadSVGFromURL","loadedObjects","Group","transformMatrix","getAttribute","line","Line","polygon","Polygon","$http","$window","saveToken","token","localStorage","getToken","logout","removeItem","payload","atob","parse","exp","now","post","service","headers","Authorization","navigationCtrl","logOut","navigation","restrict","directive"],"mappings":"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","file":"app.min.js","sourcesContent":["(function() {\r\n    angular.module('app', ['ngRoute']);\r\n    \r\n    function config($routeProvider, $locationProvider) {\r\n        $routeProvider\r\n            .when('/', {\r\n                  templateUrl: 'home/home.view.html',\r\n                  controller: 'homeCtrl',\r\n                  controllerAs: 'vm'\r\n                  \r\n            })\r\n            .when('/register', {\r\n                templateUrl: '/auth/register/register.view.html',\r\n                controller: 'registerCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/login', {\r\n                templateUrl: '/auth/login/login.view.html',\r\n                controller:'loginCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/profile', {\r\n                templateUrl: '/profile/profile.view.html',\r\n                controller:'profileCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/design/:designId', {\r\n                templateUrl: '/design/design.view.html',\r\n                controller:'designCtrl',\r\n                controllerAs:'vm'\r\n            \r\n            })\r\n            .otherwise({redirectTo: '/'});\r\n        $locationProvider.html5Mode(true);\r\n    }\r\n    \r\n    function run($rootScope, $location, authentication) {\r\n        $rootScope.$on('$routeChangeStart', function(event, nextRoute, currentRoute) {\r\n            if( $location.path() === '/profile' && !authentication.isLoggedIn()) {\r\n                $location.path('/');\r\n            }\r\n        });\r\n    }\r\n    angular\r\n        .module('app')\r\n        .config(['$routeProvider', '$locationProvider', config])\r\n        .run(['$rootScope', '$location', 'authentication', run]);\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('designCtrl', designCtrl); \r\n    \r\n    designCtrl.$inject = ['$location','$scope', 'DrawingService', 'meanData', 'authentication', '$routeParams'];\r\n    \r\n    function designCtrl($location, $scope, DrawingService, meanData, authentication, $routeParams) {\r\n        var vm = this;\r\n        vm.designId = $routeParams.designId;\r\n        vm.currentUser = authentication.currentUser();\r\n        vm.currentEmail = vm.currentUser.email;\r\n        vm.currentName = vm.currentUser.name;\r\n        vm.shareInfo = {\r\n            id: $routeParams.designId,\r\n            email: '',\r\n            permission: ''\r\n        };\r\n        vm.textOptions = {\r\n            text: '',\r\n            fontFamily: '',\r\n            fontSize: '',\r\n            textAlign: ''\r\n        };\r\n        vm.copiedObject;\r\n        vm.copiedObjects = new Array();\r\n        vm.state = new Array();\r\n        vm.mods = 0;\r\n        vm.shapeType = 'line';\r\n        vm.drawingMode = true;\r\n        vm.isDown = false;\r\n        vm.startPosition = {};\r\n        vm.viewOnly = false;\r\n        vm.canvas;\r\n        vm.init = function() {\r\n            vm.connectToSocket();\r\n            console.log('initializing fabric');\r\n            vm.canvas = new fabric.Canvas('c',{renderOnAddRemove: false});\r\n            vm.canvas.selection = false;\r\n            vm.setUpCanvas();\r\n            meanData.getDesign(vm.designId)\r\n                .success(function(data) {\r\n                    vm.setCanvasSize(data.design.size);\r\n                    vm.canvasDesign = data.design.design;\r\n                    if(data.permission === 'edit') {\r\n                        vm.canvas.loadFromJSON(vm.canvasDesign, vm.canvas.renderAll.bind(vm.canvas));\r\n                        \r\n                    } else {\r\n                        vm.canvas.loadFromJSON(vm.canvasDesign, vm.canvas.renderAll.bind(vm.canvas), function(o, object) {\r\n                            object.set('selectable', false);\r\n                        });\r\n                        vm.viewOnly = true;\r\n                    }\r\n                    vm.updateState();\r\n                    vm.designName = data.design.title;\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });  \r\n        };\r\n        vm.connectToSocket = function(){\r\n            console.log(location.pathname.toString());\r\n            var pathArray = location.pathname.split('/');\r\n            socket = io('/' + pathArray[1], {query: 'room=' + pathArray[2]});\r\n            \r\n            socket.on('updateGroup', function(msg) {\r\n                console.log(msg); \r\n            });\r\n            socket.on('designUpdate', function(design) {\r\n                if(!vm.viewOnly) {\r\n                    vm.canvas.loadFromJSON(design.design, vm.canvas.renderAll.bind(vm.canvas));\r\n                    \r\n                } else {\r\n                    vm.canvas.loadFromJSON(design.design, vm.canvas.renderAll.bind(vm.canvas), function(o, object) {\r\n                            object.set('selectable', false);\r\n                    });\r\n                }\r\n                vm.updateState();\r\n            }); \r\n            socket.on('messageRecieved', function(msg) {\r\n                var messages = $('#messages');\r\n                var date = new Date();\r\n                var postfix = (date.getHours() >= 12) ? 'pm' : 'am';\r\n                var hours = date.getHours() - (date.getHours() >= 12 ? 12 : 0);\r\n                var minutes = (date.getMinutes() >= 10) ? date.getMinutes() : '0' + date.getMinutes();\r\n                var time = hours + ':' + minutes + postfix;\r\n                messages.append($('<li class=\"message\">').html(\"<p class='messageName'>\" + msg.name + \"</p>\" + \"<p class='msgTime'>\" + time + \"</p>\"  + \"<p class='msgText'>\" + msg.message + \"</p>\"));\r\n                messages.scrollTop(messages[0].scrollHeight);\r\n            });\r\n        }\r\n        vm.copy = function() {\r\n            if(vm.canvas.getActiveGroup()){\r\n                for(var i in vm.canvas.getActiveGroup().objects){\r\n                    var object = fabric.util.object.clone(vm.canvas.getActiveGroup().objects[i]);\r\n                    object.set(\"top\", object.top+5);\r\n                    object.set(\"left\", object.left+5);\r\n                    vm.copiedObjects[i] = object;\r\n                }                    \r\n            }\r\n            else if(vm.canvas.getActiveObject()){\r\n                var object = fabric.util.object.clone(vm.canvas.getActiveObject());\r\n                object.set(\"top\", object.top+5);\r\n                object.set(\"left\", object.left+5);\r\n                vm.copiedObject = object;\r\n                vm.copiedObjects = new Array();\r\n            }\r\n        }\r\n        vm.paste = function() {\r\n            if(vm.copiedObjects.length > 0){\r\n                for(var i in vm.copiedObjects){\r\n                    vm.canvas.add(vm.copiedObjects[i]);\r\n                }                    \r\n            }\r\n            else if(vm.copiedObject){\r\n                vm.canvas.add(vm.copiedObject);\r\n            }\r\n            vm.canvas.renderAll(); \r\n            vm.updateState();\r\n            vm.saveCanvas();\r\n        }\r\n        vm.undo = function() {\r\n            if(vm.mods < vm.state.length) {\r\n                var index = vm.state.length - 1 - vm.mods - 1;\r\n                console.log('index = ' + index);\r\n                if(index > -1) {\r\n                    vm.canvas.clear().renderAll();\r\n                    vm.canvas.loadFromJSON(vm.state[index]);\r\n                    vm.canvas.renderAll();\r\n                    vm.mods += 1;\r\n                    vm.saveCanvas();\r\n                }\r\n            }\r\n        }\r\n        vm.redo = function() {\r\n            console.log(vm.mods);\r\n            if(vm.mods > 0) {\r\n                vm.canvas.clear().renderAll();\r\n                vm.canvas.loadFromJSON(vm.state[vm.state.length - 1 - vm.mods + 1]);\r\n                vm.canvas.renderAll();\r\n                vm.mods -= 1;\r\n                vm.saveCanvas();\r\n            }\r\n        }\r\n        vm.sendMessage = function() {\r\n            vm.message = {name: vm.currentName, message: $('#m').val()};\r\n            $('#m').val('');\r\n            socket.emit('sendMessage', vm.message);\r\n        }\r\n        function regularPolygonPoints(sideCount, radius) {\r\n            var sweep = Math.PI*2/sideCount;\r\n            var cx = radius + vm.shape.get('left');\r\n            var cy = radius + vm.shape.get('top');\r\n            var points = [];\r\n            for(var i = 0; i < sideCount; i++) {\r\n                var x = cx+radius*Math.cos(i*sweep);\r\n                var y = cy+radius*Math.sin(i*sweep);\r\n                points.push({x:x, y:y});\r\n            }\r\n            return points;\r\n        }\r\n        document.addEventListener('keydown', function(event) {\r\n            switch (event.keyCode) {\r\n                case 46:\r\n                    if(vm.canvas.getActiveObject()) {\r\n                        console.log('trying to delete');\r\n                        var shapeToRemove = vm.canvas.getActiveObject();\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.renderAll();\r\n                        vm.updateState();\r\n                        vm.saveCanvas();\r\n                        return;\r\n                    }\r\n                    break;\r\n                case 16:\r\n                    vm.keepSquare = true;\r\n                    break;\r\n                case 67:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.copy();\r\n                    }\r\n                    break;\r\n                case 86:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.paste();\r\n                    }\r\n                    break;\r\n                case 90:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.undo();\r\n                    }\r\n                    break;\r\n                case 89:\r\n                    if(event.ctrlKey) {\r\n                        event.preventDefault();\r\n                        vm.redo();\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n        document.addEventListener('keyup', function(event) {\r\n            switch( event.keyCode) {\r\n                case 16: \r\n                    console.log('shift released');\r\n                    vm.keepSquare = false;\r\n                    break;\r\n            }\r\n        });\r\n        vm.updateState = function() {\r\n            var canvasJson = vm.canvas.toJSON();\r\n            var canvasString = JSON.stringify(canvasJson);\r\n            vm.state.push(canvasString);\r\n\r\n        }\r\n        vm.saveCanvas = function() {\r\n            var canvasJson = vm.canvas.toJSON();\r\n            console.log(canvasJson);\r\n            var canvasString = JSON.stringify(canvasJson);\r\n            vm.currentEmail = authentication.currentUser().email;\r\n            console.log(vm.currentEmail);\r\n            vm.design = {\r\n                id: vm.designId,\r\n                owner: vm.currentEmail,\r\n                design: canvasString\r\n            }\r\n            meanData.saveDesign(vm.design)\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                    console.log('about to call socket');\r\n                    socket.emit('updateDesign', vm.design);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        }\r\n        vm.setCanvasSize = function(size) {\r\n            console.log(size);\r\n            vm.canvas.setWidth(size.width);\r\n            vm.canvas.setHeight(size.height);\r\n\r\n        };\r\n        vm.changeToRect = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'rect';\r\n            $('#rect').addClass('selectedButton'); \r\n            vm.canvas.defaultCursor = 'crosshair';\r\n        };\r\n        vm.changeToEllipse = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'ellipse';\r\n            $('#ellipse').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n\r\n\r\n        };\r\n        vm.changeToTriangle = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'triangle';\r\n            $('#triangle').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n\r\n        };\r\n        \r\n        vm.changeToText = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'i-text';\r\n            $('#i-text').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n\r\n\r\n        };\r\n        vm.changeToImgShape = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'imgShape';\r\n            $('#imgShape').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n\r\n\r\n        };\r\n        vm.changeToPolygon = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'polygon';\r\n            $('#polygon').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n\r\n\r\n        };\r\n        vm.changeToPointer = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'pointer';\r\n            $('#pointer').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'default';\r\n\r\n\r\n        };\r\n        vm.changeToLine = function() {\r\n            $('#' + vm.shapeType).removeClass('selectedButton');\r\n            vm.shapeType = 'line';\r\n            $('#line').addClass('selectedButton');\r\n            vm.canvas.defaultCursor = 'crosshair';\r\n\r\n\r\n        };\r\n        $scope.toggleChat = function() {\r\n            console.log('toggle chat called');\r\n            if($('.chatBodyContainer').css('display') == 'inline-block') {\r\n                $('.chatBodyContainer').css('display','none');  \r\n            } else {\r\n                $('.chatBodyContainer').css('display' ,'inline-block');\r\n            }\r\n        }\r\n        vm.setUpCanvas = function() {\r\n            document.getElementById('exportLink').addEventListener('click', function(e) {\r\n                console.log('called');\r\n                if(!fabric.Canvas.supports('toDataURL')) {\r\n                    alert('This browlser doesn\\'t support exporting')\r\n                } else {\r\n                    console.log('trying to export');\r\n                    this.href = vm.canvas.toDataURL({\r\n                        format: 'png',\r\n                        quality: 0.8\r\n                    });\r\n                    this.download = vm.designName + '.png';\r\n                }\r\n            });\r\n            vm.canvas.on('mouse:down', function(event) {\r\n                if(!vm.drawingMode || vm.viewOnly || vm.shapeType == 'pointer') return;\r\n                vm.isDown = true;\r\n                vm.startPosition.x = event.e.offsetX - 5;\r\n                vm.startPosition.y = event.e.offsetY - 5;\r\n                vm.drawingMode = false;\r\n                DrawingService.createShape({\r\n                    shapeType: vm.shapeType,\r\n                    startPosition: vm.startPosition\r\n                }, function(shape) {\r\n                    vm.shape = shape;\r\n                    vm.canvas.add(vm.shape);\r\n                    vm.canvas.renderAll();\r\n                    vm.drawingMode = true;\r\n                });\r\n\r\n            });\r\n            vm.canvas.on('mouse:move', function(event) {\r\n                var deltaX, deltaY;\r\n                if(!vm.isDown || !vm.drawingMode || vm.viewOnly || vm.shapeType == 'pointer') return;\r\n                switch(vm.shapeType) {\r\n                    case 'rect':\r\n                        if(vm.keepSquare) {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = deltaX;\r\n                        } else {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        }\r\n\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'ellipse':\r\n                        var rx = Math.abs(vm.startPosition.x - event.e.offsetX) / 2;\r\n                        var ry = Math.abs(vm.startPosition.y - event.e.offsetY) / 2;\r\n                        if( rx > vm.shape.strokeWidth) {\r\n                            rx -= vm.shape.strokeWidth / 2;\r\n                        }                \r\n                        if( ry > vm.shape.strokeWidth) {\r\n                            ry -= vm.shape.strokeWidth / 2;\r\n                        }\r\n                        vm.shape.set({rx: rx, ry: ry});\r\n\r\n                        if(vm.startPosition.x > event.e.offsetX) {\r\n                            vm.shape.set({originX: 'right'});\r\n                        } else {\r\n                            vm.shape.set({originX: 'left'});\r\n                        }\r\n                        if(vm.startPosition.y > event.e.offsetY) {\r\n                            vm.shape.set({originY: 'bottom'});\r\n                        } else {\r\n                            vm.shape.set({originY: 'top'});\r\n                        }\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'triangle':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'polygon':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        var radius = deltaX / 2;\r\n                        vm.shape.set({points: regularPolygonPoints(6, radius)});\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        console.log(vm.shape);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'i-text':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'imgShape':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape._objects.forEach(function(item) {\r\n                            item.setWidth(deltaX);\r\n                            item.setHeight(deltaY);\r\n                            item.setCoords();\r\n                        });\r\n                        var boundingRect = vm.shape.getBoundingRect();\r\n                        console.log(vm.shape.oCoords);\r\n                        vm.shape.set('left', vm.startPosition.x);\r\n                        vm.shape.set('top', vm.startPosition.y);\r\n                        vm.shape.setObjectsCoords();\r\n                        break;\r\n                    case 'line':\r\n                        console.log(vm.shape);\r\n                        vm.shape.set({x2: event.e.offsetX, y2: event.e.offsetY});\r\n                        break;\r\n                }\r\n                vm.canvas.renderAll();\r\n            });\r\n            vm.canvas.on('mouse:up', function(event) {\r\n                vm.isDown = false;\r\n\r\n                if(vm.drawingMode) {\r\n                    if(vm.shapeType === 'rect') {\r\n                        if(event.e.offsetY - vm.startPosition.y < 0) {\r\n                            console.log('change spinner');\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    } else if(vm.shapeType === 'triangle') {\r\n                        if(vm.offsetY - vm.startPosition.y < 0) {\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.rotate(180);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    } else if(vm.shapeType === 'imgShape') {\r\n                        vm.shape.setWidth(vm.shape._objects[0].width);\r\n                        vm.shape.setHeight(vm.shape._objects[0].height);\r\n                        vm.shape.setTransformMatrix([1,0,0,1,-30,-20]);\r\n                        vm.shape.setCoords();\r\n                        console.log(vm.shape);\r\n                        vm.canvas.renderAll();\r\n                    } else if(vm.shapeType === 'line') {\r\n//                        vm.shape.hasBorders = false;\r\n//                        vm.shape.setControlsVisibility({bl:false, mb:false, ml:false, mr:false, mt:false, tr:false, mtr:false});\r\n//                        vm.shape.lockUniScaling = false;\r\n                    }\r\n                    vm.canvas.setActiveObject(vm.shape);\r\n                    console.log('calling save');\r\n                    vm.updateState();\r\n                    vm.saveCanvas();\r\n                } \r\n            });\r\n            vm.canvas.on('before:selection:cleared', function() {\r\n                $('#textOptions').css('display', 'none');\r\n            });\r\n            vm.canvas.on('object:selected', function() {\r\n                if(!vm.viewOnly) {\r\n                    vm.drawingMode = false;\r\n                    var shape = vm.canvas.getActiveObject();\r\n                    $('#' + vm.shapeType).removeClass('selectedButton');\r\n                    vm.shapeType = shape.type;\r\n                    $('#' + vm.shapeType).addClass('selectedButton');\r\n                    console.log(shape);\r\n                    if(vm.shapeType === 'i-text') {\r\n                        vm.textOptions.text = shape.text;\r\n                        vm.textOptions.fontFamily = shape.fontFamily;\r\n                        vm.textOptions.fontSize = shape.fontSize;\r\n                        vm.textOptions.textAlign = shape.textAlign;\r\n                        $scope.$apply();\r\n                        $('#font-family select').val(shape.fontFamily);\r\n                        $('#font-size').val(shape.fontSize);\r\n\r\n                        $('#textOptions').css('display', 'inline-block');\r\n                        $('#textValue').bind('change keyup', function() {\r\n                            console.log(this.value);\r\n                            shape.text = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#font-family').change(function() {\r\n                            console.log(this.value);\r\n                            shape.fontFamily = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#font-size').change(function() {\r\n                            shape.fontSize = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#font-align').change(function() {\r\n                            shape.fontAlign = this.value;\r\n                            vm.canvas.renderAll();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#toggleBold').on('click', function() {\r\n                             shape.fontWeight = (shape.fontWeight === 'bold') ? 'normal' : 'bold';\r\n                            vm.canvas.renderAll();\r\n                            vm.saveCanvas();\r\n                        });\r\n                        $('#toggleItalic').on('click', function() {\r\n                            shape.fontStyle = (shape.fontStyle === 'italic') ? 'normal' : 'italic';\r\n                            vm.canvas.renderAll();\r\n                            vm.saveCanvas();\r\n\r\n                        });\r\n                        $('#toggleUnderline').on('click', function() {\r\n                            shape.textDecoration = (shape.textDecoration === 'underline') ? '' : 'underline';\r\n                            vm.canvas.renderAll();\r\n                        });\r\n                        $('#toggleLinethrough').on('click', function() {\r\n                            shape.textDecoration = (shape.textDecoration === 'line-through') ? '' : 'line-through';\r\n                            vm.canvas.renderAll();\r\n                            vm.saveCanvas();\r\n                        });\r\n                    } else {\r\n                        $('#textOptions').css('display', 'none');\r\n                    }\r\n                }\r\n            });\r\n            vm.canvas.on('object:moving', function() {\r\n                vm.saveCanvas(); \r\n            });\r\n            vm.canvas.on('object:scaling', function() {\r\n                vm.saveCanvas(); \r\n            });\r\n            vm.canvas.on('object:rotating', function() {\r\n                vm.saveCanvas(); \r\n            });\r\n            vm.canvas.on('selection:cleared', function() {\r\n                vm.drawingMode = true;\r\n            });\r\n    \r\n            vm.canvas.observe('object:modified', function(e) {\r\n                e.target.resizeToScale();\r\n                vm.updateState();\r\n                console.log(vm.state);\r\n                vm.saveCanvas();\r\n                \r\n            });\r\n            vm.openModal = function() {\r\n                console.log('modal opened');\r\n                $('.shareModal').css('display','block');\r\n            };\r\n            vm.closeModal = function() {\r\n                $('.shareModal').css('display', 'none');\r\n            };\r\n            vm.shareDesign = function() {\r\n                if(!vm.viewOnly) {\r\n                meanData.shareDesign(vm.shareInfo)\r\n                    .success(function(data){\r\n                        console.log(data);\r\n                        vm.closeModal();\r\n                        alert('Project shared');\r\n                    })\r\n                    .error(function(e) {\r\n                        console.log(e);\r\n                    });\r\n                }\r\n            };\r\n\r\n            fabric.Object.prototype.resizeToScale = function() {\r\n                console.log(this);\r\n                switch(this.type) {\r\n                    case 'rect':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1; \r\n                        break;\r\n                    case 'ellipse':\r\n                        this.rx *= this.scaleX;\r\n                        this.ry *= this.scaleY;\r\n                        this.width = this.rx * 2;\r\n                        this.height = this.ry * 2;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'triangle':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'polyline':\r\n                    case 'polygon':\r\n//                        var points = this.get('points');\r\n//                        for (var i = 0; i < points.length; i++) {\r\n//                            var p = points[i];\r\n//                            p.x *= this.scaleX;\r\n//                            p.y *= this.scaleY;\r\n//                        }\r\n//                        this.scaleX = 1;\r\n//                        this.scaleY = 1;\r\n//                        this.width = this.getBoundingBox().width;\r\n//                        this.height = this.getBoundingBox().height;\r\n                        break;\r\n                    case 'imgShape':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        vm.init();\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('homeCtrl', homeCtrl);\r\n    \r\n    function homeCtrl() {\r\n        console.log('home controller is running');\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('profileCtrl', profileCtrl);\r\n    profileCtrl.$inject = ['$location', 'meanData', 'authentication', '$scope'];\r\n    function profileCtrl($location, meanData, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        vm.user = {};\r\n        vm.designs = {};\r\n        vm.sharedDesigns = {};\r\n        vm.currentEmail = authentication.currentUser().email;\r\n        vm.design = {\r\n            title: '',\r\n            owner: vm.currentEmail,\r\n            design: '',\r\n            size: ''\r\n        };\r\n        meanData.getProfile()\r\n            .success(function(data) {\r\n                vm.user = data;\r\n                console.log(vm.user.email);\r\n                meanData.getDesigns(vm.user.email)\r\n                    .success(function(data) {\r\n                        console.log(data);\r\n                        vm.designs = data.designs;\r\n                        meanData.getSharedDesigns(vm.user.email)\r\n                            .success(function(data) {\r\n                            vm.sharedDesigns = data.sharedDesigns;\r\n                        })\r\n                        .error( function(e) {\r\n                            console.log(e);\r\n                        });\r\n                    })\r\n                    .error( function(e) {\r\n                        console.log(e);\r\n                    });\r\n            })\r\n            .error( function(e) {\r\n                console.log(e);\r\n            });\r\n        vm.openModal = function() {\r\n            console.log('modal opened');\r\n            $('.designModal').css('display','block');\r\n        };\r\n        $scope.openDiv = function(value) {\r\n            console.log(value);\r\n            if(value === 'custom') {\r\n                console.log('yay custom');\r\n                document.getElementById('customSizeDiv').style.display = 'block';\r\n                document.getElementById('width').required = true;\r\n                document.getElementById('height').required = true;\r\n                \r\n            } else {\r\n                console.log('no custom');\r\n                document.getElementById('customSizeDiv').style.display = 'none';\r\n                document.getElementById('height').required = false;\r\n                document.getElementById('width').required = false;\r\n\r\n            }\r\n        };\r\n        vm.closeModal = function() {\r\n            $('.designModal').css('display', 'none');\r\n        };\r\n        vm.timeSince = function(date) {\r\n            var oldDate = new Date(date);\r\n            var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\n             return monthNames[oldDate.getMonth()] + ' ' + oldDate.getDate() + ', ' + oldDate.getFullYear();\r\n        };\r\n        vm.submitNewDesign = function() {\r\n            if(vm.design.size === 'Large') {\r\n                vm.design.size = {width: 1500, height:1000};\r\n            } else if(vm.design.size === 'Medium') {\r\n                vm.design.size = {width: 800, height: 800};\r\n            } else if(vm.design.size === 'Small') {\r\n                vm.design.size = {width: 400, height: 600};\r\n            } else if(vm.design.size === 'Custom') {\r\n                vm.design.size = {width: document.getElementById('width').value, height: document.getElementById('height').value};\r\n            }\r\n            meanData.createDesign(vm.design)\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                })\r\n                .success(function(data){\r\n                    console.log('in controller');\r\n                    console.log(data);\r\n                    $location.path('/design/' + data.id);\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('loginCtrl', loginCtrl);\r\n    \r\n    loginCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function loginCtrl($location, authentication,$scope) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            email: '',\r\n            password: ''\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            authentication\r\n                .login(vm.credentials)\r\n                .error(function(err) {\r\n                    console.log(err);\r\n                    $scope.error = err.message;\r\n//                    $scope.$apply();\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    \r\n    angular\r\n        .module('app')\r\n        .controller('registerCtrl', registerCtrl);\r\n    registerCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function registerCtrl($location, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            name: \"\",\r\n            email: \"\",\r\n            password: \"\"\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            console.log('submitting registration');\r\n            authentication\r\n                .register(vm.credentials)\r\n                .error(function(err) {\r\n                    $scope.error = err.message;\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular.module('app')\r\n        .factory('DrawingService', DrawingService);\r\n    \r\n    DrawingService.$inject = ['ShapeService'];\r\n    function DrawingService(ShapeService) {\r\n        \r\n        var drawingFactory = {};\r\n        \r\n        drawingFactory.createShape = function(options, callback) {\r\n            var parentClass = null;\r\n            console.log(options.shapeType);\r\n            if(options.shapeType === 'rect') {\r\n                parentClass = ShapeService.createRect;\r\n            } else if(options.shapeType === 'ellipse') {\r\n                parentClass = ShapeService.createEllipse;\r\n            } else if(options.shapeType === 'triangle') {\r\n                parentClass = ShapeService.createTriangle;\r\n            } else if(options.shapeType === 'imgShape') {\r\n                parentClass = ShapeService.createImgShape;\r\n            } else if(options.shapeType === 'i-text') {\r\n                parentClass = ShapeService.createText;\r\n            } else if(options.shapeType === 'polygon') {\r\n                parentClass = ShapeService.createPolygon;\r\n            } else if(options.shapeType === 'line') {\r\n                parentClass = ShapeService.createLine;\r\n            }\r\n            \r\n            new parentClass(options, function(shape) {\r\n                callback(shape);\r\n            });\r\n        }\r\n        return drawingFactory;\r\n    };\r\n})();\n(function() {\r\n    angular.module('app')\r\n            .factory('ShapeService', ShapeService);\r\n    \r\n    function ShapeService() {\r\n        \r\n        var shapeFactory = {};\r\n        \r\n        shapeFactory.createRect = function(options, callback) {\r\n            var rect = new fabric.Rect({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                stroke:'black',\r\n                strokeWidth:1,\r\n                fill:'transparent'\r\n            });\r\n            callback(rect);\r\n        }\r\n        shapeFactory.createEllipse = function(options, callback) {\r\n            var ellipse = new fabric.Ellipse({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                originX: 'left',\r\n                originY: 'top',\r\n                rx: 0,\r\n                ry: 0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1                \r\n            });\r\n            callback(ellipse);\r\n        }\r\n        shapeFactory.createTriangle = function(options, callback) {\r\n            var triangle = new fabric.Triangle({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1            \r\n            });\r\n            callback(triangle);\r\n        }\r\n        shapeFactory.createText = function(options, callback) {\r\n            var text = new fabric.IText(\"Click to change text\", {\r\n                top: options.startPosition.x,\r\n                left: options.startPosition.y,\r\n                fontSize: 18,\r\n            });\r\n            callback(text);\r\n        }\r\n        shapeFactory.createImgShape = function(params, callback) {\r\n            var group = [];\r\n            fabric.loadSVGFromURL('svgs/imageShape.svg', function(objects, options) {\r\n                var loadedObjects = new fabric.Group(group);\r\n                loadedObjects.set({\r\n                    left: params.startPosition.x,\r\n                    top: params.startPosition.y,\r\n                    fill: 'transparent',\r\n                    stroke: 'black',\r\n                    originX: 'left',\r\n                    originY: 'top',\r\n                    strokeWidth: 1,\r\n                    type: 'imgShape',\r\n                    transformMatrix: [1,0,0,1,0,0]\r\n                });\r\n                console.log(loadedObjects);\r\n                callback(loadedObjects);\r\n            },\r\n            function(item, object) {\r\n                object.set('id', item.getAttribute('id'));\r\n                group.push(object);\r\n            });\r\n\r\n        }\r\n        shapeFactory.createLine = function(params, callback) {\r\n            var points = [params.startPosition.x,params.startPosition.y,params.startPosition.x, params.startPosition.y];\r\n            console.log(points);\r\n            var line = new fabric.Line(points, {\r\n                strokeWidth: 3,\r\n                fill: 'black',\r\n                stroke: 'black',\r\n                originX: 'center',\r\n                originY: 'center'\r\n            });\r\n            callback(line);\r\n        }\r\n        shapeFactory.createPolygon = function(params, callback) {\r\n            var points = regularPolygonPoints(6,5);\r\n            var polygon = new fabric.Polygon(points, {\r\n                stroke: 'black',\r\n                left: params.startPosition.x,\r\n                top: params.startPosition.y,\r\n                strokeWidth: 2,\r\n                fill:'transparent'\r\n            }, false);\r\n            callback(polygon);\r\n        }\r\n        function regularPolygonPoints(sideCount, radius) {\r\n            var sweep = Math.PI*2/sideCount;\r\n            var cx = radius;\r\n            var cy = radius;\r\n            var points = [];\r\n            for(var i = 0; i < sideCount; i++) {\r\n                var x = cx+radius*Math.cos(i*sweep);\r\n                var y = cy+radius*Math.sin(i*sweep);\r\n                points.push({x:x, y:y});\r\n            }\r\n            return points;\r\n        }\r\n        return shapeFactory;\r\n    };\r\n    \r\n    \r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .service('authentication', authentication);\r\n    \r\n    authentication.$inject = ['$http', '$window'];\r\n    function authentication($http, $window) {\r\n        var saveToken = function(token) {\r\n            $window.localStorage['mean-token'] = token;\r\n        };\r\n        \r\n        var getToken = function() {\r\n            return $window.localStorage['mean-token'];\r\n        };\r\n        \r\n        logout = function() {\r\n            $window.localStorage.removeItem('mean-token');\r\n        };\r\n        \r\n        var isLoggedIn = function() {\r\n            var token = getToken();\r\n            var payload;\r\n            \r\n            if(token) {\r\n                payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                \r\n                return payload.exp > Date.now() / 1000;\r\n            } else {\r\n                return false;\r\n            }\r\n        };\r\n        var currentUser = function() {\r\n            if(isLoggedIn()) {\r\n                var token = getToken();\r\n                var payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                return {\r\n                    email: payload.email,\r\n                    name: payload.name\r\n                };\r\n            }\r\n        };\r\n        register = function(user) {\r\n            return $http.post('/api/register', user).success(function(data) {\r\n                saveToken(data.token);\r\n            })\r\n            .error(function(e) {\r\n            \r\n            });\r\n        };\r\n        login = function(user) {\r\n            return $http.post('/api/login', user).success(function(data) {\r\n                saveToken(data.token);\r\n            });\r\n        };\r\n        return {\r\n            saveToken: saveToken,\r\n            getToken: getToken,\r\n            logout: logout,\r\n            isLoggedIn: isLoggedIn,\r\n            currentUser: currentUser,\r\n            register: register,\r\n            login: login,\r\n            logout: logout\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .service('meanData', meanData);\r\n    \r\n    meanData.$inject = ['$http', 'authentication', '$location'];\r\n    function meanData($http, authentication, $location) {\r\n        var getProfile = function() {\r\n            console.log(authentication.getToken());\r\n            return $http.get('/api/profile', {\r\n                headers: {\r\n                    Authorization: 'Bearer ' + authentication.getToken()\r\n                }\r\n            });\r\n        };\r\n        var getDesigns = function(email) {\r\n            console.log(email);\r\n            return $http.get('/api/designs', {params: {email: email}})\r\n                .success(function(data) {\r\n                    console.log(data);   \r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        };\r\n        var getSharedDesigns = function(email) {\r\n            return $http.get('api/designs/shared', {params: {email: email}})\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        };\r\n        var getDesign = function(designId) {\r\n            return $http.get('/api/design', {params: {id: designId, email: authentication.currentUser().email}})\r\n                .success(function(data) {\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e)\r\n                });\r\n        };\r\n        var saveDesign = function(design) {\r\n              return $http.post('/api/designs/save', design)\r\n                    .success(function(data) {\r\n                  console.log(data);\r\n              });\r\n        };\r\n        var createDesign = function(design) {\r\n            return $http.post('/api/designs/save', design)\r\n                .success(function(data) {\r\n                  console.log('in data service');\r\n                    console.log(data);\r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n            \r\n        };\r\n        var shareDesign = function(shareInfo) {\r\n              return $http.post('api/designs/share', shareInfo)\r\n                .success(function(data) {\r\n                  console.log('in mean data');\r\n                })\r\n                .error(function(e) {\r\n                  console.log(e);\r\n                });\r\n        };\r\n        \r\n        return {\r\n            getProfile: getProfile,\r\n            getDesigns: getDesigns,\r\n            getSharedDesigns: getSharedDesigns,\r\n            saveDesign: saveDesign,\r\n            getDesign: getDesign,\r\n            createDesign: createDesign,\r\n            shareDesign: shareDesign\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('navigationCtrl', navigationCtrl);\r\n    navigationCtrl.$inject = ['$location', 'authentication', '$scope'];\r\n    function navigationCtrl($location, authentication, $scope) {\r\n        var vm = this;\r\n\r\n        $scope.isLoggedIn = function() {\r\n            return authentication.isLoggedIn();\r\n        }\r\n        $scope.currentUser = function() {\r\n            if($scope.isLoggedIn()) {\r\n                return authentication.currentUser().name;\r\n            }\r\n        }\r\n        console.log($scope.isLoggedIn());\r\n        $scope.logOut = function() {\r\n            authentication.logout();\r\n            $location.path('/');\r\n        }\r\n    }\r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .directive('navigation', navigation);\r\n    \r\n    function navigation() {\r\n        return {\r\n            restrict: 'A',\r\n            templateUrl: '/common/directives/navigation/navigation.template.html',\r\n            controller: 'navigationCtrl as navvm'\r\n        };\r\n    }\r\n})();"]}