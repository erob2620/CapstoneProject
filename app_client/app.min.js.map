{"version":3,"sources":["app.min.js"],"names":["config","$routeProvider","$locationProvider","when","templateUrl","controller","controllerAs","otherwise","redirectTo","html5Mode","run","$rootScope","$location","authentication","$on","event","nextRoute","currentRoute","path","isLoggedIn","angular","module","homeCtrl","console","log","designCtrl","$scope","DrawingService","meanData","vm","this","designId","shapeType","drawingMode","isDown","startPosition","canvas","init","fabric","Canvas","selection","setUpCanvas","document","addEventListener","keyCode","getActiveObject","shapeToRemove","remove","renderAll","keepSquare","MyApp","saveCanvas","canvasJson","toJSON","canvasString","JSON","stringify","currentEmail","currentUser","email","design","id","owner","saveDesign","changeToRectangle","changeToEllipse","changeToTriangle","on","x","e","offsetX","y","offsetY","shape","createShape","add","deltaX","deltaY","setWidth","setHeight","setCoords","rx","Math","abs","ry","strokeWidth","set","originX","originY","getCenterPoint","radius","points","starPolygonPoints","get","length","boundingBox","getBoundingBox","width","height","top","getHeight","rotate","setActiveObject","type","observe","target","resizeToScale","Object","prototype","scaleX","scaleY","i","p","$inject","profileCtrl","user","designs","getProfile","success","data","getDesigns","error","loginCtrl","credentials","password","onSubmit","login","err","then","registerCtrl","name","register","ShapeService","drawingFactory","options","parentClass","createRect","createEllipse","createTriangle","factory","shapeFactory","rect","Rect","left","stroke","fill","ellipse","Ellipse","triangle","Triangle","$http","$window","saveToken","token","localStorage","getToken","logout","removeItem","payload","split","atob","parse","exp","Date","now","post","service","headers","Authorization","params","navigationCtrl","navigation","restrict","directive"],"mappings":"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","file":"app.min.js","sourcesContent":["(function() {\r\n    angular.module('app', ['ngRoute']);\r\n    \r\n    function config($routeProvider, $locationProvider) {\r\n        $routeProvider\r\n            .when('/', {\r\n                  templateUrl: 'home/home.view.html',\r\n                  controller: 'homeCtrl',\r\n                  controllerAs: 'vm'\r\n                  \r\n            })\r\n            .when('/register', {\r\n                templateUrl: '/auth/register/register.view.html',\r\n                controller: 'registerCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/login', {\r\n                templateUrl: '/auth/login/login.view.html',\r\n                controller:'loginCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/profile', {\r\n                templateUrl: '/profile/profile.view.html',\r\n                controller:'profileCtrl',\r\n                controllerAs: 'vm'\r\n            })\r\n            .when('/design', {\r\n                templateUrl: '/design/design.view.html',\r\n                controller:'designCtrl',\r\n                controllerAs:'vm'\r\n            \r\n            })\r\n            .otherwise({redirectTo: '/'});\r\n        $locationProvider.html5Mode(true);\r\n    }\r\n    \r\n    function run($rootScope, $location, authentication) {\r\n        $rootScope.$on('$routeChangeStart', function(event, nextRoute, currentRoute) {\r\n            if( $location.path() === '/profile' && !authentication.isLoggedIn()) {\r\n                $location.path('/');\r\n            }\r\n        });\r\n    }\r\n    angular\r\n        .module('app')\r\n        .config(['$routeProvider', '$locationProvider', config])\r\n        .run(['$rootScope', '$location', 'authentication', run]);\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('homeCtrl', homeCtrl);\r\n    \r\n    function homeCtrl() {\r\n        console.log('home controller is running');\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('designCtrl', designCtrl); \r\n    \r\n    designCtrl.$inject = ['$location','$scope', 'DrawingService', 'meanData', 'authentication'];\r\n    \r\n    function designCtrl($location, $scope, DrawingService, meanData, authentication) {\r\n        var vm = this;\r\n        vm.designId;\r\n        vm.shapeType = 'rect';\r\n        vm.drawingMode = true;\r\n        vm.isDown = false;\r\n        vm.startPosition = {};\r\n//        $scope.FabricConstants = FabricConstants;\r\n        vm.canvas;\r\n        vm.init = function() {\r\n            console.log('initializing fabric');\r\n            vm.canvas = new fabric.Canvas('c');\r\n            console.log(vm.canvas);\r\n            vm.canvas.selection = false;\r\n            vm.setUpCanvas();\r\n        };\r\n        document.addEventListener('keydown', function(event) {\r\n            console.log('in key down');\r\n            switch (event.keyCode) {\r\n                case 46:\r\n                    if(vm.canvas.getActiveObject()) {\r\n                        console.log('trying to delete');\r\n                        var shapeToRemove = vm.canvas.getActiveObject();\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.remove(shapeToRemove);\r\n                        vm.canvas.renderAll();\r\n                        return;\r\n                    }\r\n                    break;\r\n                case 16:\r\n                    vm.keepSquare = true;\r\n                    break;\r\n            }\r\n        });\r\n        document.addEventListener('keyup', function(event) {\r\n            switch( event.keyCode) {\r\n                case 16: \r\n                    console.log('shift released');\r\n                    MyApp.keepSquare = false;\r\n                    break;\r\n            }\r\n        });\r\n        vm.saveCanvas = function() {\r\n            var canvasJson = vm.canvas.toJSON();\r\n            console.log(canvasJson);\r\n            var canvasString = JSON.stringify(canvasJson);\r\n//            meanData.getProfile().success(function(data) {\r\n//                console.log(data.email);\r\n//                vm.currentUser = data.email;\r\n//                console.log(vm.currentUser);\r\n//\r\n//            });\r\n            vm.currentEmail = authentication.currentUser().email;\r\n            console.log(vm.currentEmail);\r\n            vm.design = {\r\n                id: vm.designId,\r\n                owner: vm.currentEmail,\r\n                design: canvasString\r\n            }\r\n            meanData.saveDesign(vm.design);\r\n        }\r\n        vm.changeToRectangle = function() {\r\n            vm.shapeType = 'rect';\r\n        };\r\n        vm.changeToEllipse = function() {\r\n            vm.shapeType = 'ellipse';\r\n        };\r\n        vm.changeToTriangle = function() {\r\n            vm.shapeType = 'triangle';\r\n        };\r\n        vm.setUpCanvas = function() {\r\n            vm.canvas.on('mouse:down', function(event) {\r\n                console.log(event);\r\n                if(!vm.drawingMode) return;\r\n                vm.isDown = true;\r\n                vm.startPosition.x = event.e.offsetX - 5;\r\n                vm.startPosition.y = event.e.offsetY - 5;\r\n                vm.shape = DrawingService.createShape({\r\n                    shapeType: vm.shapeType,\r\n                    startPosition: vm.startPosition\r\n                });\r\n                console.log(vm.shape);\r\n                vm.canvas.add(vm.shape);\r\n            });\r\n            vm.canvas.on('mouse:move', function(event) {\r\n                var deltaX, deltaY;\r\n                if(!vm.isDown || !vm.drawingMode) return;\r\n                switch(vm.shapeType) {\r\n                    case 'rect':\r\n                        if(vm.keepSquare) {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = deltaX;\r\n                        } else {\r\n                            deltaX = event.e.offsetX - vm.startPosition.x;\r\n                            deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        }\r\n\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'ellipse':\r\n                        var rx = Math.abs(vm.startPosition.x - event.e.offsetX) / 2;\r\n                        var ry = Math.abs(vm.startPosition.y - event.e.offsetY) / 2;\r\n                        if( rx > vm.shape.strokeWidth) {\r\n                            rx -= vm.shape.strokeWidth / 2;\r\n                        }                \r\n                        if( ry > vm.shape.strokeWidth) {\r\n                            ry -= vm.shape.strokeWidth / 2;\r\n                        }\r\n                        vm.shape.set({rx: rx, ry: ry});\r\n\r\n                        if(vm.startPosition.x > event.e.offsetX) {\r\n                            vm.shape.set({originX: 'right'});\r\n                        } else {\r\n                            vm.shape.set({originX: 'left'});\r\n                        }\r\n                        if(vm.startPosition.y > event.e.offsetY) {\r\n                            vm.shape.set({originY: 'bottom'});\r\n                        } else {\r\n                            vm.shape.set({originY: 'top'});\r\n                        }\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'triangle':\r\n                        deltaX = event.e.offsetX - vm.startPosition.x;\r\n                        deltaY = event.e.offsetY - vm.startPosition.y;\r\n                        vm.shape.setWidth(deltaX);\r\n                        vm.shape.setHeight(deltaY);\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                    case 'polygon':\r\n                        var centerX = vm.shape.getCenterPoint().x;\r\n                        console.log(vm.shape.getCenterPoint());\r\n                        var radius = (event.e.offsetX - vm.startPosition.x) / 2;\r\n                        var points = starPolygonPoints(vm.shape.get('points').length / 2, radius, radius / 2);\r\n                        var boundingBox = vm.shape.getBoundingBox();\r\n                        vm.shape.set({points: points, width: boundingBox.width, height: boundingBox.height});\r\n                        vm.shape.setCoords();\r\n                        break;\r\n                }\r\n                vm.canvas.renderAll();\r\n            });\r\n            vm.canvas.on('mouse:up', function(event) {\r\n                vm.isDown = false;\r\n\r\n                if(vm.drawingMode) {\r\n                    if(vm.shapeType === 'rect') {\r\n                        if(event.e.offsetY - vm.startPosition.y < 0) {\r\n                            console.log('change spinner');\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    } else if(vm.shapeType === 'triangle') {\r\n                        if(vm.offsetY - vm.startPosition.y < 0) {\r\n                            vm.shape.top = event.e.offsetY;\r\n                            vm.shape.setHeight(vm.shape.getHeight() * -1);\r\n                            vm.shape.rotate(180);\r\n                            vm.shape.setCoords();\r\n                        }\r\n                    }\r\n                    vm.canvas.setActiveObject(vm.shape);\r\n                } \r\n            });\r\n            vm.canvas.on('object:selected', function() {\r\n                vm.drawingMode = false;\r\n                var shape = vm.canvas.getActiveObject();\r\n                vm.shapeType = shape.type;\r\n                console.log(vm.shapeType);\r\n            });\r\n            vm.canvas.on('selection:cleared', function() {\r\n                vm.drawingMode = true;\r\n            });\r\n    \r\n            vm.canvas.observe('object:modified', function(e) {\r\n                e.target.resizeToScale();\r\n            });\r\n            \r\n            fabric.Object.prototype.resizeToScale = function() {\r\n                switch(this.type) {\r\n                    case 'rect':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1; \r\n                        break;\r\n                    case 'ellipse':\r\n                        this.rx *= this.scaleX;\r\n                        this.ry *= this.scaleY;\r\n                        this.width = this.rx * 2;\r\n                        this.height = this.ry * 2;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'triangle':\r\n                        this.width *= this.scaleX;\r\n                        this.height *= this.scaleY;\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        break;\r\n                    case 'polyline':\r\n                    case 'polygon':\r\n                        var points = this.get('points');\r\n                        for (var i = 0; i < points.length; i++) {\r\n                            var p = points[i];\r\n                            p.x *= this.scaleX;\r\n                            p.y *= this.scaleY;\r\n                        }\r\n                        this.scaleX = 1;\r\n                        this.scaleY = 1;\r\n                        this.width = this.getBoundingBox().width;\r\n                        this.height = this.getBoundingBox().height;\r\n                        break;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        vm.init();\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('profileCtrl', profileCtrl);\r\n    profileCtrl.$inject = ['$location', 'meanData'];\r\n    function profileCtrl($location, meanData) {\r\n        var vm = this;\r\n\r\n        vm.user = {};\r\n        vm.designs = {};\r\n        meanData.getProfile()\r\n            .success(function(data) {\r\n                vm.user = data;\r\n                console.log(vm.user.email);\r\n                meanData.getDesigns(vm.user.email)\r\n                    .success(function(data) {\r\n                        console.log(data);\r\n                        vm.designs = data.designs;\r\n                    })\r\n                    .error( function(e) {\r\n                        console.log(e);\r\n                    });\r\n            })\r\n            .error( function(e) {\r\n                console.log(e);\r\n            });\r\n        \r\n    }   \r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('loginCtrl', loginCtrl);\r\n    \r\n    loginCtrl.$inject = ['$location', 'authentication'];\r\n    function loginCtrl($location, authentication) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            email: '',\r\n            password: ''\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            authentication\r\n                .login(vm.credentials)\r\n                .error(function(err) {\r\n                    console.log(err);\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    \r\n    angular\r\n        .module('app')\r\n        .controller('registerCtrl', registerCtrl);\r\n    registerCtrl.$inject = ['$location', 'authentication'];\r\n    function registerCtrl($location, authentication) {\r\n        var vm = this;\r\n\r\n        vm.credentials = {\r\n            name: \"\",\r\n            email: \"\",\r\n            password: \"\"\r\n        };\r\n\r\n        vm.onSubmit = function() {\r\n            console.log('submitting registration');\r\n            authentication\r\n                .register(vm.credentials)\r\n                .error(function(err) {\r\n                    console.log(err);\r\n                })\r\n                .then(function() {\r\n                    $location.path('profile');\r\n                });\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular.module('app')\r\n        .factory('DrawingService', DrawingService);\r\n    \r\n    DrawingService.$inject = ['ShapeService'];\r\n    function DrawingService(ShapeService) {\r\n        \r\n        var drawingFactory = {};\r\n        \r\n        drawingFactory.createShape = function(options) {\r\n            var parentClass = null;\r\n            console.log(options.shapeType);\r\n            if(options.shapeType === 'rect') {\r\n                parentClass = ShapeService.createRect;\r\n            } else if(options.shapeType === 'ellipse') {\r\n                parentClass = ShapeService.createEllipse;\r\n            } else if(options.shapeType === 'triangle') {\r\n                parentClass = ShapeService.createTriangle;\r\n            }\r\n            \r\n            return new parentClass(options);\r\n        }\r\n        return drawingFactory;\r\n    };\r\n})();\n(function() {\r\n    angular.module('app')\r\n            .factory('ShapeService', ShapeService);\r\n    \r\n    function ShapeService() {\r\n        \r\n        var shapeFactory = {};\r\n        \r\n        shapeFactory.createRect = function(options) {\r\n            var rect = new fabric.Rect({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                stroke:'black',\r\n                strokeWidth:1,\r\n                fill:'transparent'\r\n            });\r\n            return rect;\r\n        }\r\n        shapeFactory.createEllipse = function(options) {\r\n            var ellipse = new fabric.Ellipse({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                originX: 'left',\r\n                originY: 'top',\r\n                rx: 0,\r\n                ry: 0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1                \r\n            });\r\n            return ellipse;\r\n        }\r\n        shapeFactory.createTriangle = function(options) {\r\n            var triangle = new fabric.Triangle({\r\n                left: options.startPosition.x,\r\n                top: options.startPosition.y,\r\n                width:0,\r\n                height:0,\r\n                fill: 'transparent',\r\n                stroke: 'black',\r\n                strokeWidth: 1            \r\n            });\r\n            return triangle;\r\n        }\r\n        \r\n        return shapeFactory;\r\n    };\r\n    \r\n    \r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .service('authentication', authentication);\r\n    \r\n    authentication.$inject = ['$http', '$window'];\r\n    function authentication($http, $window) {\r\n        var saveToken = function(token) {\r\n            $window.localStorage['mean-token'] = token;\r\n        };\r\n        \r\n        var getToken = function() {\r\n            return $window.localStorage['mean-token'];\r\n        };\r\n        \r\n        logout = function() {\r\n            $window.localStorage.removeItem('mean-token');\r\n        };\r\n        \r\n        var isLoggedIn = function() {\r\n            var token = getToken();\r\n            var payload;\r\n            \r\n            if(token) {\r\n                payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                \r\n                return payload.exp > Date.now() / 1000;\r\n            } else {\r\n                return false;\r\n            }\r\n        };\r\n        var currentUser = function() {\r\n            if(isLoggedIn()) {\r\n                var token = getToken();\r\n                var payload = token.split('.')[1];\r\n                payload = $window.atob(payload);\r\n                payload = JSON.parse(payload);\r\n                return {\r\n                    email: payload.email,\r\n                    name: payload.name\r\n                };\r\n            }\r\n        };\r\n        register = function(user) {\r\n            return $http.post('/api/register', user).success(function(data) {\r\n                saveToken(data.token);\r\n            });\r\n        };\r\n        login = function(user) {\r\n            return $http.post('/api/login', user).success(function(data) {\r\n                saveToken(data.token);\r\n            });\r\n        };\r\n        return {\r\n            saveToken: saveToken,\r\n            getToken: getToken,\r\n            logout: logout,\r\n            isLoggedIn: isLoggedIn,\r\n            currentUser: currentUser,\r\n            register: register,\r\n            login: login,\r\n            logout: logout\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .service('meanData', meanData);\r\n    \r\n    meanData.$inject = ['$http', 'authentication'];\r\n    function meanData($http, authentication) {\r\n        var getProfile = function() {\r\n            console.log(authentication.getToken());\r\n            return $http.get('/api/profile', {\r\n                headers: {\r\n                    Authorization: 'Bearer ' + authentication.getToken()\r\n                }\r\n            });\r\n        };\r\n        var getDesigns = function(email) {\r\n            console.log(email);\r\n            return $http.get('/api/designs', {params: {email: email}})\r\n                .success(function(data) {\r\n                    console.log(data);   \r\n                })\r\n                .error(function(e) {\r\n                    console.log(e);\r\n                });\r\n        };\r\n        var saveDesign = function(design) {\r\n              $http.post('/api/designs/save', design)\r\n                    .success(function(data) {\r\n                  console.log(data);\r\n              });\r\n        };\r\n        return {\r\n            getProfile: getProfile,\r\n            getDesigns: getDesigns,\r\n            saveDesign: saveDesign\r\n        };\r\n    }\r\n})();\n(function() {\r\n    angular\r\n        .module('app')\r\n        .controller('navigationCtrl', navigationCtrl);\r\n    navigationCtrl.$inject = ['$location', 'authentication'];\r\n    function navigationCtrl($location, authentication) {\r\n        var vm = this;\r\n\r\n        vm.isLoggedIn = authentication.isLoggedIn();\r\n\r\n        vm.currentUser = authentication.currentUser();\r\n    }\r\n})();\n(function () {\r\n    angular\r\n        .module('app')\r\n        .directive('navigation', navigation);\r\n    \r\n    function navigation() {\r\n        return {\r\n            restrict: 'EA',\r\n            templateUrl: '/common/directives/navigation/navigation.template.html',\r\n            controller: 'navigationCtrl as navvm'\r\n        };\r\n    }\r\n})();"]}