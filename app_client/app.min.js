!function(){function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/design",{templateUrl:"/design/design.view.html",controller:"designCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}function t(e,t,o){e.$on("$routeChangeStart",function(e,n,i){"/profile"!==t.path()||o.isLoggedIn()||t.path("/")})}angular.module("app",["ngRoute"]),angular.module("app").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",t])}(),function(){function e(){console.log("home controller is running")}angular.module("app").controller("homeCtrl",e)}(),function(){function e(e,t,o,n,i){var s=this;s.designId,s.shapeType="rect",s.drawingMode=!0,s.isDown=!1,s.startPosition={},s.canvas,s.init=function(){console.log("initializing fabric"),s.canvas=new fabric.Canvas("c"),console.log(s.canvas),s.canvas.selection=!1,s.setUpCanvas()},document.addEventListener("keydown",function(e){switch(console.log("in key down"),e.keyCode){case 46:if(s.canvas.getActiveObject()){console.log("trying to delete");var t=s.canvas.getActiveObject();return s.canvas.remove(t),s.canvas.remove(t),void s.canvas.renderAll()}break;case 16:s.keepSquare=!0}}),document.addEventListener("keyup",function(e){switch(e.keyCode){case 16:console.log("shift released"),MyApp.keepSquare=!1}}),s.saveCanvas=function(){var e=s.canvas.toJSON();console.log(e);var t=JSON.stringify(e);s.currentEmail=i.currentUser().email,console.log(s.currentEmail),s.design={id:s.designId,owner:s.currentEmail,design:t},n.saveDesign(s.design)},s.changeToRectangle=function(){s.shapeType="rect"},s.changeToEllipse=function(){s.shapeType="ellipse"},s.changeToTriangle=function(){s.shapeType="triangle"},s.setUpCanvas=function(){s.canvas.on("mouse:down",function(e){console.log(e),s.drawingMode&&(s.isDown=!0,s.startPosition.x=e.e.offsetX-5,s.startPosition.y=e.e.offsetY-5,s.shape=o.createShape({shapeType:s.shapeType,startPosition:s.startPosition}),console.log(s.shape),s.canvas.add(s.shape))}),s.canvas.on("mouse:move",function(e){var t,o;if(s.isDown&&s.drawingMode){switch(s.shapeType){case"rect":s.keepSquare?(t=e.e.offsetX-s.startPosition.x,o=t):(t=e.e.offsetX-s.startPosition.x,o=e.e.offsetY-s.startPosition.y),s.shape.setWidth(t),s.shape.setHeight(o),s.shape.setCoords();break;case"ellipse":var n=Math.abs(s.startPosition.x-e.e.offsetX)/2,i=Math.abs(s.startPosition.y-e.e.offsetY)/2;n>s.shape.strokeWidth&&(n-=s.shape.strokeWidth/2),i>s.shape.strokeWidth&&(i-=s.shape.strokeWidth/2),s.shape.set({rx:n,ry:i}),s.startPosition.x>e.e.offsetX?s.shape.set({originX:"right"}):s.shape.set({originX:"left"}),s.startPosition.y>e.e.offsetY?s.shape.set({originY:"bottom"}):s.shape.set({originY:"top"}),s.shape.setCoords();break;case"triangle":t=e.e.offsetX-s.startPosition.x,o=e.e.offsetY-s.startPosition.y,s.shape.setWidth(t),s.shape.setHeight(o),s.shape.setCoords();break;case"polygon":s.shape.getCenterPoint().x;console.log(s.shape.getCenterPoint());var a=(e.e.offsetX-s.startPosition.x)/2,r=starPolygonPoints(s.shape.get("points").length/2,a,a/2),c=s.shape.getBoundingBox();s.shape.set({points:r,width:c.width,height:c.height}),s.shape.setCoords()}s.canvas.renderAll()}}),s.canvas.on("mouse:up",function(e){s.isDown=!1,s.drawingMode&&("rect"===s.shapeType?e.e.offsetY-s.startPosition.y<0&&(console.log("change spinner"),s.shape.top=e.e.offsetY,s.shape.setHeight(-1*s.shape.getHeight()),s.shape.setCoords()):"triangle"===s.shapeType&&s.offsetY-s.startPosition.y<0&&(s.shape.top=e.e.offsetY,s.shape.setHeight(-1*s.shape.getHeight()),s.shape.rotate(180),s.shape.setCoords()),s.canvas.setActiveObject(s.shape))}),s.canvas.on("object:selected",function(){s.drawingMode=!1;var e=s.canvas.getActiveObject();s.shapeType=e.type,console.log(s.shapeType)}),s.canvas.on("selection:cleared",function(){s.drawingMode=!0}),s.canvas.observe("object:modified",function(e){e.target.resizeToScale()}),fabric.Object.prototype.resizeToScale=function(){switch(this.type){case"rect":this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1;break;case"ellipse":this.rx*=this.scaleX,this.ry*=this.scaleY,this.width=2*this.rx,this.height=2*this.ry,this.scaleX=1,this.scaleY=1;break;case"triangle":this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1;break;case"polyline":case"polygon":for(var e=this.get("points"),t=0;t<e.length;t++){var o=e[t];o.x*=this.scaleX,o.y*=this.scaleY}this.scaleX=1,this.scaleY=1,this.width=this.getBoundingBox().width,this.height=this.getBoundingBox().height}}},s.init()}angular.module("app").controller("designCtrl",e),e.$inject=["$location","$scope","DrawingService","meanData","authentication"]}(),function(){function e(e,t){var o=this;o.user={},o.designs={},t.getProfile().success(function(e){o.user=e,console.log(o.user.email),t.getDesigns(o.user.email).success(function(e){console.log(e),o.designs=e.designs}).error(function(e){console.log(e)})}).error(function(e){console.log(e)})}angular.module("app").controller("profileCtrl",e),e.$inject=["$location","meanData"]}(),function(){function e(e,t){var o=this;o.credentials={email:"",password:""},o.onSubmit=function(){t.login(o.credentials).error(function(e){console.log(e)}).then(function(){e.path("profile")})}}angular.module("app").controller("loginCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(e,t){var o=this;o.credentials={name:"",email:"",password:""},o.onSubmit=function(){console.log("submitting registration"),t.register(o.credentials).error(function(e){console.log(e)}).then(function(){e.path("profile")})}}angular.module("app").controller("registerCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(e){var t={};return t.createShape=function(t){var o=null;return console.log(t.shapeType),"rect"===t.shapeType?o=e.createRect:"ellipse"===t.shapeType?o=e.createEllipse:"triangle"===t.shapeType&&(o=e.createTriangle),new o(t)},t}angular.module("app").factory("DrawingService",e),e.$inject=["ShapeService"]}(),function(){function e(){var e={};return e.createRect=function(e){var t=new fabric.Rect({left:e.startPosition.x,top:e.startPosition.y,width:0,height:0,stroke:"black",strokeWidth:1,fill:"transparent"});return t},e.createEllipse=function(e){var t=new fabric.Ellipse({left:e.startPosition.x,top:e.startPosition.y,originX:"left",originY:"top",rx:0,ry:0,fill:"transparent",stroke:"black",strokeWidth:1});return t},e.createTriangle=function(e){var t=new fabric.Triangle({left:e.startPosition.x,top:e.startPosition.y,width:0,height:0,fill:"transparent",stroke:"black",strokeWidth:1});return t},e}angular.module("app").factory("ShapeService",e)}(),function(){function e(e,t){var o=function(e){t.localStorage["mean-token"]=e},n=function(){return t.localStorage["mean-token"]};logout=function(){t.localStorage.removeItem("mean-token")};var i=function(){var e,o=n();return o?(e=o.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3):!1},s=function(){if(i()){var e=n(),o=e.split(".")[1];return o=t.atob(o),o=JSON.parse(o),{email:o.email,name:o.name}}};return register=function(t){return e.post("/api/register",t).success(function(e){o(e.token)})},login=function(t){return e.post("/api/login",t).success(function(e){o(e.token)})},{saveToken:o,getToken:n,logout:logout,isLoggedIn:i,currentUser:s,register:register,login:login,logout:logout}}angular.module("app").service("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t){var o=function(){return console.log(t.getToken()),e.get("/api/profile",{headers:{Authorization:"Bearer "+t.getToken()}})},n=function(t){return console.log(t),e.get("/api/designs",{params:{email:t}}).success(function(e){console.log(e)}).error(function(e){console.log(e)})},i=function(t){e.post("/api/designs/save",t).success(function(e){console.log(e)})};return{getProfile:o,getDesigns:n,saveDesign:i}}angular.module("app").service("meanData",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var o=this;o.isLoggedIn=t.isLoggedIn(),o.currentUser=t.currentUser()}angular.module("app").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("app").directive("navigation",e)}();
//# sourceMappingURL=app.min.js.map
