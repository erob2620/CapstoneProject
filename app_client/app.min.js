!function(){function e(e,t){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/design/:designId",{templateUrl:"/design/design.view.html",controller:"designCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}function t(e,t,n){e.$on("$routeChangeStart",function(e,o,s){"/profile"!==t.path()||n.isLoggedIn()||t.path("/")})}angular.module("app",["ngRoute"]),angular.module("app").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication",t])}(),function(){function e(){console.log("home controller is running")}angular.module("app").controller("homeCtrl",e)}(),function(){function e(e,t,n,o,s,i){var a=this;a.designId=i.designId,a.currentEmail=s.currentUser().email,a.shareInfo={id:i.designId,email:"",permission:""},a.shapeType="rect",a.drawingMode=!0,a.isDown=!1,a.startPosition={},a.viewOnly=!1,a.canvas,a.init=function(){a.connectToSocket(),console.log("initializing fabric"),a.canvas=new fabric.Canvas("c"),a.canvas.selection=!1,a.setUpCanvas(),o.getDesign(a.designId).success(function(e){a.setCanvasSize(e.design.size),a.canvasDesign=e.design.design,"edit"===e.permission?a.canvas.loadFromJSON(a.canvasDesign,a.canvas.renderAll.bind(a.canvas)):(a.canvas.loadFromJSON(a.canvasDesign,a.canvas.renderAll.bind(a.canvas),function(e,t){t.set("selectable",!1)}),a.viewOnly=!0),a.designName=e.design.title}).error(function(e){console.log(e)})},a.connectToSocket=function(){console.log(location.pathname.toString());var e=location.pathname.split("/");socket=io("/"+e[1],{query:"room="+e[2]}),socket.on("updateGroup",function(e){console.log(e)}),socket.on("designUpdate",function(e){a.viewOnly?a.canvas.loadFromJSON(design,a.canvas.renderAll.bind(a.canvas),function(e,t){t.set("selectable",!1)}):a.canvas.loadFromJSON(design,a.canvas.renderAll.bind(a.canvas))})},document.addEventListener("keydown",function(e){switch(console.log("in key down"),e.keyCode){case 46:if(a.canvas.getActiveObject()){console.log("trying to delete");var t=a.canvas.getActiveObject();return a.canvas.remove(t),a.canvas.remove(t),a.canvas.renderAll(),void a.saveCanvas()}break;case 16:a.keepSquare=!0}}),document.addEventListener("keyup",function(e){switch(e.keyCode){case 16:console.log("shift released"),a.keepSquare=!1}}),a.saveCanvas=function(){var e=a.canvas.toJSON();console.log(e);var t=JSON.stringify(e);a.currentEmail=s.currentUser().email,console.log(a.currentEmail),a.design={id:a.designId,owner:a.currentEmail,design:t},o.saveDesign(a.design).success(function(e){console.log("about to call socket"),socket.emit("updateDesign",a.canvas.getActiveObject())}).error(function(e){console.log(e)})},a.setCanvasSize=function(e){console.log(e),a.canvas.setWidth(e.width),a.canvas.setHeight(e.height)},a.changeToRect=function(){a.shapeType="rect"},a.changeToEllipse=function(){a.shapeType="ellipse"},a.changeToTriangle=function(){a.shapeType="triangle"},a.changeToText=function(){a.shapeType="i-text"},a.changeToImgShape=function(){a.shapeType="imgShape"},a.setUpCanvas=function(){document.getElementById("exportLink").addEventListener("click",function(e){console.log("called"),fabric.Canvas.supports("toDataURL")?(console.log("trying to export"),this.href=a.canvas.toDataURL({format:"png",quality:.8}),this.download=a.designName+".png"):alert("This browlser doesn't support exporting")}),a.canvas.on("mouse:down",function(e){a.drawingMode&&!a.viewOnly&&(a.isDown=!0,a.startPosition.x=e.e.offsetX-5,a.startPosition.y=e.e.offsetY-5,a.drawingMode=!1,n.createShape({shapeType:a.shapeType,startPosition:a.startPosition},function(e){a.shape=e,a.canvas.add(a.shape),a.canvas.renderAll(),a.drawingMode=!0}))}),a.canvas.on("mouse:move",function(e){var t,n;if(a.isDown&&a.drawingMode&&!a.viewOnly){switch(a.shapeType){case"rect":a.keepSquare?(t=e.e.offsetX-a.startPosition.x,n=t):(t=e.e.offsetX-a.startPosition.x,n=e.e.offsetY-a.startPosition.y),a.shape.setWidth(t),a.shape.setHeight(n),a.shape.setCoords();break;case"ellipse":var o=Math.abs(a.startPosition.x-e.e.offsetX)/2,s=Math.abs(a.startPosition.y-e.e.offsetY)/2;o>a.shape.strokeWidth&&(o-=a.shape.strokeWidth/2),s>a.shape.strokeWidth&&(s-=a.shape.strokeWidth/2),a.shape.set({rx:o,ry:s}),a.startPosition.x>e.e.offsetX?a.shape.set({originX:"right"}):a.shape.set({originX:"left"}),a.startPosition.y>e.e.offsetY?a.shape.set({originY:"bottom"}):a.shape.set({originY:"top"}),a.shape.setCoords();break;case"triangle":t=e.e.offsetX-a.startPosition.x,n=e.e.offsetY-a.startPosition.y,a.shape.setWidth(t),a.shape.setHeight(n),a.shape.setCoords();break;case"polygon":a.shape.getCenterPoint().x;console.log(a.shape.getCenterPoint());var i=(e.e.offsetX-a.startPosition.x)/2,r=starPolygonPoints(a.shape.get("points").length/2,i,i/2),c=a.shape.getBoundingBox();a.shape.set({points:r,width:c.width,height:c.height}),a.shape.setCoords();break;case"i-text":t=e.e.offsetX-a.startPosition.x,n=e.e.offsetY-a.startPosition.y,a.shape.setWidth(t),a.shape.setCoords();break;case"imgShape":t=e.e.offsetX-a.startPosition.x,n=e.e.offsetY-a.startPosition.y,a.shape._objects.forEach(function(e){e.setWidth(t),e.setHeight(n),e.setCoords()});a.shape.getBoundingRect();console.log(a.shape.oCoords),a.shape.set("left",a.startPosition.x),a.shape.set("top",a.startPosition.y),a.shape.setObjectsCoords()}a.canvas.renderAll()}}),a.canvas.on("mouse:up",function(e){a.isDown=!1,a.drawingMode&&("rect"===a.shapeType?e.e.offsetY-a.startPosition.y<0&&(console.log("change spinner"),a.shape.top=e.e.offsetY,a.shape.setHeight(-1*a.shape.getHeight()),a.shape.setCoords()):"triangle"===a.shapeType?a.offsetY-a.startPosition.y<0&&(a.shape.top=e.e.offsetY,a.shape.setHeight(-1*a.shape.getHeight()),a.shape.rotate(180),a.shape.setCoords()):"imgShape"===a.shapeType&&(a.shape.setWidth(a.shape._objects[0].width),a.shape.setHeight(a.shape._objects[0].height),a.shape.setTransformMatrix([1,0,0,1,-30,-20]),a.shape.setCoords(),console.log(a.shape),a.canvas.renderAll()),a.canvas.setActiveObject(a.shape),a.saveCanvas())}),a.canvas.on("object:selected",function(){if(!a.viewOnly){a.drawingMode=!1;var e=a.canvas.getActiveObject();a.shapeType=e.type,console.log(a.shapeType)}}),a.canvas.on("selection:cleared",function(){a.drawingMode=!0}),a.canvas.observe("object:modified",function(e){e.target.resizeToScale(),a.saveCanvas()}),a.openModal=function(){console.log("modal opened"),$(".shareModal").css("display","block")},a.closeModal=function(){$(".shareModal").css("display","none")},a.shareDesign=function(){a.viewOnly||o.shareDesign(a.shareInfo).success(function(e){console.log(e),a.closeModal(),alert("Project shared")}).error(function(e){console.log(e)})},fabric.Object.prototype.resizeToScale=function(){switch(console.log(this),this.type){case"rect":this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1;break;case"ellipse":this.rx*=this.scaleX,this.ry*=this.scaleY,this.width=2*this.rx,this.height=2*this.ry,this.scaleX=1,this.scaleY=1;break;case"triangle":this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1;break;case"polyline":case"polygon":for(var e=this.get("points"),t=0;t<e.length;t++){var n=e[t];n.x*=this.scaleX,n.y*=this.scaleY}this.scaleX=1,this.scaleY=1,this.width=this.getBoundingBox().width,this.height=this.getBoundingBox().height;break;case"imgShape":this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1}}},a.init()}angular.module("app").controller("designCtrl",e),e.$inject=["$location","$scope","DrawingService","meanData","authentication","$routeParams"]}(),function(){function e(e,t,n,o){var s=this;s.user={},s.designs={},s.sharedDesigns={},s.currentEmail=n.currentUser().email,s.design={title:"",owner:s.currentEmail,design:"",size:""},t.getProfile().success(function(e){s.user=e,console.log(s.user.email),t.getDesigns(s.user.email).success(function(e){console.log(e),s.designs=e.designs,t.getSharedDesigns(s.user.email).success(function(e){s.sharedDesigns=e.sharedDesigns}).error(function(e){console.log(e)})}).error(function(e){console.log(e)})}).error(function(e){console.log(e)}),s.openModal=function(){console.log("modal opened"),$(".designModal").css("display","block")},o.openDiv=function(e){console.log(e),"custom"===e?(console.log("yay custom"),document.getElementById("customSizeDiv").style.display="block",document.getElementById("width").required=!0,document.getElementById("height").required=!0):(console.log("no custom"),document.getElementById("customSizeDiv").style.display="none",document.getElementById("height").required=!1,document.getElementById("width").required=!1)},s.closeModal=function(){$(".designModal").css("display","none")},s.timeSince=function(e){var t=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"];return n[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()},s.submitNewDesign=function(){"Large"===s.design.size?s.design.size={width:1500,height:1e3}:"Medium"===s.design.size?s.design.size={width:800,height:800}:"Small"===s.design.size?s.design.size={width:400,height:600}:"Custom"===s.design.size&&(s.design.size={width:document.getElementById("width").value,height:document.getElementById("height").value}),t.createDesign(s.design).error(function(e){console.log(e)}).success(function(t){console.log("in controller"),console.log(t),e.path("/design/"+t.id)})}}angular.module("app").controller("profileCtrl",e),e.$inject=["$location","meanData","authentication","$scope"]}(),function(){function e(e,t,n){var o=this;o.credentials={email:"",password:""},o.onSubmit=function(){t.login(o.credentials).error(function(e){console.log(e),n.error=e.message}).then(function(){e.path("profile")})}}angular.module("app").controller("loginCtrl",e),e.$inject=["$location","authentication","$scope"]}(),function(){function e(e,t,n){var o=this;o.credentials={name:"",email:"",password:""},o.onSubmit=function(){console.log("submitting registration"),t.register(o.credentials).error(function(e){n.error=e.message}).then(function(){e.path("profile")})}}angular.module("app").controller("registerCtrl",e),e.$inject=["$location","authentication","$scope"]}(),function(){function e(e){var t={};return t.createShape=function(t,n){var o=null;console.log(t.shapeType),"rect"===t.shapeType?o=e.createRect:"ellipse"===t.shapeType?o=e.createEllipse:"triangle"===t.shapeType?o=e.createTriangle:"imgShape"===t.shapeType?o=e.createImgShape:"i-text"===t.shapeType&&(o=e.createText),new o(t,function(e){n(e)})},t}angular.module("app").factory("DrawingService",e),e.$inject=["ShapeService"]}(),function(){function e(){var e={};return e.createRect=function(e,t){var n=new fabric.Rect({left:e.startPosition.x,top:e.startPosition.y,width:0,height:0,stroke:"black",strokeWidth:1,fill:"transparent"});t(n)},e.createEllipse=function(e,t){var n=new fabric.Ellipse({left:e.startPosition.x,top:e.startPosition.y,originX:"left",originY:"top",rx:0,ry:0,fill:"transparent",stroke:"black",strokeWidth:1});t(n)},e.createTriangle=function(e,t){var n=new fabric.Triangle({left:e.startPosition.x,top:e.startPosition.y,width:0,height:0,fill:"transparent",stroke:"black",strokeWidth:1});t(n)},e.createText=function(e,t){var n=new fabric.IText("Click to change text",{top:e.startPosition.x,left:e.startPosition.y,fontSize:18});t(n)},e.createImgShape=function(e,t){var n=[];fabric.loadSVGFromURL("svgs/imageShape.svg",function(o,s){var i=new fabric.Group(n);i.set({left:e.startPosition.x,top:e.startPosition.y,fill:"transparent",stroke:"black",originX:"left",originY:"top",strokeWidth:1,type:"imgShape",transformMatrix:[1,0,0,1,0,0]}),console.log(i),t(i)},function(e,t){t.set("id",e.getAttribute("id")),n.push(t)})},e}angular.module("app").factory("ShapeService",e)}(),function(){function e(e,t){var n=function(e){t.localStorage["mean-token"]=e},o=function(){return t.localStorage["mean-token"]};logout=function(){t.localStorage.removeItem("mean-token")};var s=function(){var e,n=o();return n?(e=n.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3):!1},i=function(){if(s()){var e=o(),n=e.split(".")[1];return n=t.atob(n),n=JSON.parse(n),{email:n.email,name:n.name}}};return register=function(t){return e.post("/api/register",t).success(function(e){n(e.token)}).error(function(e){})},login=function(t){return e.post("/api/login",t).success(function(e){n(e.token)})},{saveToken:n,getToken:o,logout:logout,isLoggedIn:s,currentUser:i,register:register,login:login,logout:logout}}angular.module("app").service("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t,n){var o=function(){return console.log(t.getToken()),e.get("/api/profile",{headers:{Authorization:"Bearer "+t.getToken()}})},s=function(t){return console.log(t),e.get("/api/designs",{params:{email:t}}).success(function(e){console.log(e)}).error(function(e){console.log(e)})},i=function(t){return e.get("api/designs/shared",{params:{email:t}}).success(function(e){console.log(e)}).error(function(e){console.log(e)})},a=function(n){return e.get("/api/design",{params:{id:n,email:t.currentUser().email}}).success(function(e){console.log(e)}).error(function(e){console.log(e)})},r=function(t){return e.post("/api/designs/save",t).success(function(e){console.log(e)})},c=function(t){return e.post("/api/designs/save",t).success(function(e){console.log("in data service"),console.log(e)}).error(function(e){console.log(e)})},l=function(t){return e.post("api/designs/share",t).success(function(e){console.log("in mean data")}).error(function(e){console.log(e)})};return{getProfile:o,getDesigns:s,getSharedDesigns:i,saveDesign:r,getDesign:a,createDesign:c,shareDesign:l}}angular.module("app").service("meanData",e),e.$inject=["$http","authentication","$location"]}(),function(){function e(e,t,n){n.isLoggedIn=function(){return t.isLoggedIn()},n.currentUser=function(){return n.isLoggedIn()?t.currentUser().name:void 0},console.log(n.isLoggedIn()),n.logOut=function(){t.logout(),e.path("/")}}angular.module("app").controller("navigationCtrl",e),e.$inject=["$location","authentication","$scope"]}(),function(){function e(){return{restrict:"A",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("app").directive("navigation",e)}();
//# sourceMappingURL=app.min.js.map
